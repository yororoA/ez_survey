{"ast":null,"code":"var _jsxFileName = \"E:\\\\Desktop\\\\\\u684C\\u9762\\\\\\u5DE5\\u4F5C\\\\\\u7F16\\u7A0B\\\\\\u524D\\u7AEF\\\\projext\\\\project\\\\src\\\\components\\\\draftsDisplay\\\\renderDrafts.jsx\",\n  _s = $RefreshSig$();\nimport React, { useCallback, useContext, useState } from 'react';\nimport { RenderDraftsContext } from \"./context/drafts\";\nimport { useNavigate } from \"react-router-dom\";\nimport { getQueDetails } from \"../../utils/getUserSurveys\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst RenderDrafts = () => {\n  _s();\n  // 鼠标移入移出控制按钮显示\n  const [hoverId, setHoverId] = useState(null);\n  const handleMouseEnter = useCallback(e => {\n    setHoverId(e.target.id);\n  }, [hoverId]);\n  const handleMouseLeave = useCallback(e => {\n    setHoverId(null);\n  }, [hoverId]);\n\n  // 是否存在草稿\n  const [hasDraft, setHasDraft] = useState(false);\n  try {\n    fetch(`http://localhost:1337/api/clients/${localStorage.getItem('token')}`).then(resp => {\n      if (!resp.ok) {\n        throw new Error(`获取用户数据失败: ${resp.status}`);\n      }\n      return resp.json();\n    }).then(data => {\n      console.log(data);\n      const surveys = data.data.surveys;\n      if (surveys == null || surveys === '') {\n        setHasDraft(false);\n      } else {\n        setHasDraft(true);\n      }\n    });\n  } catch (err) {\n    console.error(err);\n  }\n\n  // element参考信息\n  const drafts = useContext(RenderDraftsContext);\n  const elements = drafts.map(draft => {\n    return {\n      title: draft.title,\n      description: draft.description,\n      id: draft.id\n    };\n  });\n  // 编辑跳转\n  // 采用编程式导航\n  const navigate = useNavigate();\n  async function handleEditClick(e) {\n    e.preventDefault();\n    // 将问卷相关信息存入sessionStorage\n    const data = drafts.filter(draft => draft.id === e.currentTarget.id)[0];\n    sessionStorage.setItem('surveyTitle', data.title);\n    sessionStorage.setItem('surveyDescription', data.description);\n    sessionStorage.setItem('surveyTokenBefore', e.currentTarget.id);\n    // 等待所有题目信息存入sessionStorage\n    const queTokensBefore = [];\n    await Promise.all(data.questions.map(async question => {\n      const r = await getQueDetails(question);\n      if (r) {\n        sessionStorage.setItem(r.title, JSON.stringify(r));\n      }\n    }));\n    data.questions.forEach(question => {\n      queTokensBefore.push(question);\n    });\n    sessionStorage.setItem('queTokensBefore', JSON.stringify(queTokensBefore));\n    // 跳转到publish\n    navigate('../publish');\n  }\n  console.log(drafts);\n  console.log(elements);\n  const elementsForRender = elements.map(element => /*#__PURE__*/_jsxDEV(\"fieldset\", {\n    id: element.id,\n    onMouseEnter: handleMouseEnter,\n    onMouseLeave: handleMouseLeave,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: element.title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: element.description\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 4\n    }, this), hoverId === element.id && /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleEditClick,\n        id: element.id,\n        children: '编辑'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        children: '预览'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        children: '删除'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        children: '发布'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 6\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 5\n    }, this)]\n  }, element.id, true, {\n    fileName: _jsxFileName,\n    lineNumber: 81,\n    columnNumber: 3\n  }, this));\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: elementsForRender\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 103,\n    columnNumber: 3\n  }, this);\n};\n_s(RenderDrafts, \"4Vi43EWc0b66OZ4KveC5eTQEPFY=\", false, function () {\n  return [useNavigate];\n});\n_c = RenderDrafts;\nexport default RenderDrafts;\nvar _c;\n$RefreshReg$(_c, \"RenderDrafts\");","map":{"version":3,"names":["React","useCallback","useContext","useState","RenderDraftsContext","useNavigate","getQueDetails","jsxDEV","_jsxDEV","RenderDrafts","_s","hoverId","setHoverId","handleMouseEnter","e","target","id","handleMouseLeave","hasDraft","setHasDraft","fetch","localStorage","getItem","then","resp","ok","Error","status","json","data","console","log","surveys","err","error","drafts","elements","map","draft","title","description","navigate","handleEditClick","preventDefault","filter","currentTarget","sessionStorage","setItem","queTokensBefore","Promise","all","questions","question","r","JSON","stringify","forEach","push","elementsForRender","element","onMouseEnter","onMouseLeave","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","_c","$RefreshReg$"],"sources":["E:/Desktop/桌面/工作/编程/前端/projext/project/src/components/draftsDisplay/renderDrafts.jsx"],"sourcesContent":["import React, {useCallback, useContext, useState} from 'react';\r\nimport {RenderDraftsContext} from \"./context/drafts\";\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport {getQueDetails} from \"../../utils/getUserSurveys\";\r\n\r\nconst RenderDrafts = () => {\r\n\t// 鼠标移入移出控制按钮显示\r\n\tconst [hoverId, setHoverId] = useState(null);\r\n\tconst handleMouseEnter = useCallback(e => {\r\n\t\tsetHoverId(e.target.id);\r\n\t}, [hoverId]);\r\n\tconst handleMouseLeave = useCallback(e => {\r\n\t\tsetHoverId(null);\r\n\t}, [hoverId]);\r\n\r\n\r\n\t// 是否存在草稿\r\n\tconst [hasDraft, setHasDraft] = useState(false);\r\n\ttry {\r\n\t\tfetch(`http://localhost:1337/api/clients/${localStorage.getItem('token')}`)\r\n\t\t\t.then(resp => {\r\n\t\t\t\tif(!resp.ok){\r\n\t\t\t\t\tthrow new Error(`获取用户数据失败: ${resp.status}`);\r\n\t\t\t\t}\r\n\t\t\t\treturn resp.json();\r\n\t\t\t})\r\n\t\t\t.then(data => {\r\n\t\t\t\tconsole.log(data);\r\n\t\t\t\tconst surveys = data.data.surveys;\r\n\t\t\t\tif (surveys == null || surveys===''){\r\n\t\t\t\t\tsetHasDraft(false);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tsetHasDraft(true);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t}catch (err){\r\n\t\tconsole.error(err);\r\n\t}\r\n\r\n\r\n\t// element参考信息\r\n\tconst drafts = useContext(RenderDraftsContext);\r\n\tconst elements = drafts.map(draft => {\r\n\t\treturn {\r\n\t\t\ttitle: draft.title,\r\n\t\t\tdescription: draft.description,\r\n\t\t\tid: draft.id\r\n\t\t}\r\n\t});\r\n\t// 编辑跳转\r\n\t// 采用编程式导航\r\n\tconst navigate = useNavigate()\r\n\r\n\tasync function handleEditClick(e) {\r\n\t\te.preventDefault();\r\n\t\t// 将问卷相关信息存入sessionStorage\r\n\t\tconst data = drafts.filter(draft => draft.id === e.currentTarget.id)[0];\r\n\t\tsessionStorage.setItem('surveyTitle', data.title);\r\n\t\tsessionStorage.setItem('surveyDescription', data.description);\r\n\t\tsessionStorage.setItem('surveyTokenBefore', e.currentTarget.id);\r\n\t\t// 等待所有题目信息存入sessionStorage\r\n\t\tconst queTokensBefore = [];\r\n\t\tawait Promise.all(data.questions.map(async (question) => {\r\n\t\t\tconst r = await getQueDetails(question);\r\n\t\t\tif (r) {\r\n\t\t\t\tsessionStorage.setItem(r.title, JSON.stringify(r));\r\n\t\t\t}\r\n\t\t}));\r\n\t\tdata.questions.forEach(question => {\r\n\t\t\tqueTokensBefore.push(question);\r\n\t\t})\r\n\t\tsessionStorage.setItem('queTokensBefore', JSON.stringify(queTokensBefore));\r\n\t\t// 跳转到publish\r\n\t\tnavigate('../publish')\r\n\t}\r\n\r\n\r\n\tconsole.log(drafts);\r\n\tconsole.log(elements);\r\n\tconst elementsForRender = elements.map(element => (\r\n\t\t<fieldset key={element.id} id={element.id} onMouseEnter={handleMouseEnter} onMouseLeave={handleMouseLeave}>\r\n\t\t\t<div>\r\n\t\t\t\t<div>{element.title}</div>\r\n\t\t\t\t<div>{element.description}</div>\r\n\t\t\t</div>\r\n\t\t\t<hr/>\r\n\t\t\t{hoverId === element.id && (\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<button onClick={handleEditClick} id={element.id}>\r\n\t\t\t\t\t\t{'编辑'}\r\n\t\t\t\t\t\t{/*<Link to=\"../publish\" className={link.link}>{'编辑'}</Link>*/}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<button>{'预览'}</button>\r\n\t\t\t\t\t<button>{'删除'}</button>\r\n\t\t\t\t\t<button>{'发布'}</button>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t</fieldset>\r\n\t))\r\n\r\n\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t{elementsForRender}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default RenderDrafts;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}