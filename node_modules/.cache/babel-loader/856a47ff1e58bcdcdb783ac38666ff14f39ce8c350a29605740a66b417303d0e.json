{"ast":null,"code":"var _jsxFileName = \"E:\\\\Desktop\\\\\\u684C\\u9762\\\\\\u5DE5\\u4F5C\\\\\\u7F16\\u7A0B\\\\\\u524D\\u7AEF\\\\projext\\\\project\\\\src\\\\components\\\\editSurvey\\\\ques\\\\single.jsx\",\n  _s = $RefreshSig$();\nimport React, { useCallback, useContext, useEffect, useRef, useState } from 'react';\nimport { GetTitleContext } from \"../context/getTitleContext\";\nimport { CancelEditContext, ConfirmEditContext, EditingQueContext, InitialDataContext, IsEditingContext } from \"../context/reEditQueContext\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Single = () => {\n  _s();\n  // edit\n  const isEditing = useContext(IsEditingContext);\n  const editingQue = useContext(EditingQueContext);\n  // 存储问题内容\n  const [question, setQuestion] = useState(isEditing ? editingQue : '');\n  // 存储选项列表, [{id, content}]\n  const [options, setOptions] = useState([]);\n  // 当前选项编号, 1 -> A\n  const [optionIndex, setOptionIndex] = useState(1);\n\n  // 问题输入\n  // 获取返回标题的函数\n  const getTitle = useContext(GetTitleContext);\n  // 每次修改标题时的上一个标题\n  const lastTitle = useRef(question);\n  const handleQuestionChange = useCallback(e => {\n    const quesTitle = e.target.value;\n    // 清除上一次的会话内存\n    if (lastTitle.current) {\n      sessionStorage.removeItem(lastTitle.current);\n    }\n    lastTitle.current = quesTitle;\n    setQuestion(quesTitle);\n    // ...sessionStorage\n    const data = {\n      title: quesTitle,\n      options,\n      type: 'single'\n    };\n    sessionStorage.setItem(`${quesTitle}`, JSON.stringify(data));\n    // 将问题标题返回给publish\n    getTitle(quesTitle);\n  }, [options]);\n\n  // 添加新选项\n  const addOption = useCallback(e => {\n    e.preventDefault();\n    // 选项标识 A,B,C,...\n    const label = String.fromCharCode(optionIndex + 64);\n    // 选项编号递增, 用于下次生成新标识, 函数式更新避免依赖optionIndex\n    setOptionIndex(prevIndex => prevIndex + 1);\n    // \t添加新选项到数组, 初始为空\n    const newOptions = [...options, {\n      id: label,\n      content: ''\n    }];\n    setOptions(newOptions);\n    // ...sessionStorage\n    const data = {\n      title: question,\n      options: newOptions,\n      type: 'single'\n    };\n    sessionStorage.setItem(`${question}`, JSON.stringify(data));\n  }, [question, options]);\n\n  // 选项内容变化\n  const handleOptionChange = useCallback(e => {\n    // 更新对应选项内容\n    // console.log(e.target.value)\n    const id = e.target.id;\n    // 若选项id相同则更新content\n    const newOptions = options.map(option => option.id === id ? {\n      ...option,\n      content: e.target.value\n    } : option);\n    setOptions(newOptions);\n    // ...sessionStorage\n    const data = {\n      title: question,\n      options: newOptions,\n      type: 'single'\n    };\n    sessionStorage.setItem(`${question}`, JSON.stringify(data));\n  }, [question, options]);\n\n  // 编辑问题\n  const confirmEdit = useContext(ConfirmEditContext);\n  const cancelEdit = useContext(CancelEditContext);\n  const initialData = useContext(InitialDataContext);\n\n  // 确认编辑\n  function handleConfirmEdit(e) {\n    e.preventDefault();\n    sessionStorage.removeItem('');\n    confirmEdit(question);\n  }\n\n  // 取消编辑\n  function handleCancelEdit(e) {\n    e.preventDefault();\n    sessionStorage.removeItem('');\n    sessionStorage.removeItem(question);\n    sessionStorage.setItem(editingQue, JSON.stringify(initialData));\n    cancelEdit();\n  }\n  useEffect(() => {\n    // console.log(options);\n  }, [options]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"input\", {\n      onChange: handleQuestionChange,\n      placeholder: '请输入问题'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: options.map((option, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          children: option.id\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 8\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          id: option.id,\n          value: option.content,\n          onChange: handleOptionChange,\n          placeholder: '请输入内容'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 8\n        }, this)]\n      }, option.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 7\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: addOption,\n      children: \"\\u6DFB\\u52A0\\u9009\\u9879\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 4\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 110,\n    columnNumber: 3\n  }, this);\n};\n_s(Single, \"vsHywToDoaRHFR2nOsyjZyKOmNc=\");\n_c = Single;\nexport default Single;\nvar _c;\n$RefreshReg$(_c, \"Single\");","map":{"version":3,"names":["React","useCallback","useContext","useEffect","useRef","useState","GetTitleContext","CancelEditContext","ConfirmEditContext","EditingQueContext","InitialDataContext","IsEditingContext","jsxDEV","_jsxDEV","Single","_s","isEditing","editingQue","question","setQuestion","options","setOptions","optionIndex","setOptionIndex","getTitle","lastTitle","handleQuestionChange","e","quesTitle","target","value","current","sessionStorage","removeItem","data","title","type","setItem","JSON","stringify","addOption","preventDefault","label","String","fromCharCode","prevIndex","newOptions","id","content","handleOptionChange","map","option","confirmEdit","cancelEdit","initialData","handleConfirmEdit","handleCancelEdit","children","onChange","placeholder","fileName","_jsxFileName","lineNumber","columnNumber","index","onClick","_c","$RefreshReg$"],"sources":["E:/Desktop/桌面/工作/编程/前端/projext/project/src/components/editSurvey/ques/single.jsx"],"sourcesContent":["import React, {useCallback, useContext, useEffect, useRef, useState} from 'react';\r\nimport {GetTitleContext} from \"../context/getTitleContext\";\r\nimport {\r\n\tCancelEditContext,\r\n\tConfirmEditContext,\r\n\tEditingQueContext,\r\n\tInitialDataContext,\r\n\tIsEditingContext\r\n} from \"../context/reEditQueContext\";\r\n\r\nconst Single = () => {\r\n\t// edit\r\n\tconst isEditing = useContext(IsEditingContext);\r\n\tconst editingQue = useContext(EditingQueContext);\r\n\t// 存储问题内容\r\n\tconst [question, setQuestion] = useState(isEditing ? editingQue : '');\r\n\t// 存储选项列表, [{id, content}]\r\n\tconst [options, setOptions] = useState([]);\r\n\t// 当前选项编号, 1 -> A\r\n\tconst [optionIndex, setOptionIndex] = useState(1);\r\n\r\n\t// 问题输入\r\n\t// 获取返回标题的函数\r\n\tconst getTitle = useContext(GetTitleContext);\r\n\t// 每次修改标题时的上一个标题\r\n\tconst lastTitle = useRef(question);\r\n\tconst handleQuestionChange = useCallback(e => {\r\n\t\tconst quesTitle = e.target.value;\r\n\t\t// 清除上一次的会话内存\r\n\t\tif (lastTitle.current) {\r\n\t\t\tsessionStorage.removeItem(lastTitle.current);\r\n\t\t}\r\n\t\tlastTitle.current = quesTitle\r\n\t\tsetQuestion(quesTitle);\r\n\t\t// ...sessionStorage\r\n\t\tconst data = {\r\n\t\t\ttitle: quesTitle,\r\n\t\t\toptions,\r\n\t\t\ttype: 'single'\r\n\t\t};\r\n\t\tsessionStorage.setItem(`${quesTitle}`, JSON.stringify(data));\r\n\t\t// 将问题标题返回给publish\r\n\t\tgetTitle(quesTitle);\r\n\t}, [options]);\r\n\r\n\t// 添加新选项\r\n\tconst addOption = useCallback(e => {\r\n\t\te.preventDefault();\r\n\t\t// 选项标识 A,B,C,...\r\n\t\tconst label = String.fromCharCode(optionIndex + 64);\r\n\t\t// 选项编号递增, 用于下次生成新标识, 函数式更新避免依赖optionIndex\r\n\t\tsetOptionIndex(prevIndex => prevIndex + 1);\r\n\t\t// \t添加新选项到数组, 初始为空\r\n\t\tconst newOptions = [...options, {id: label, content: ''}];\r\n\t\tsetOptions(newOptions);\r\n\t\t// ...sessionStorage\r\n\t\tconst data = {\r\n\t\t\ttitle: question,\r\n\t\t\toptions: newOptions,\r\n\t\t\ttype: 'single'\r\n\t\t}\r\n\t\tsessionStorage.setItem(`${question}`, JSON.stringify(data));\r\n\t}, [question, options]);\r\n\r\n\t// 选项内容变化\r\n\tconst handleOptionChange = useCallback((e) => {\r\n\t\t// 更新对应选项内容\r\n\t\t// console.log(e.target.value)\r\n\t\tconst id = e.target.id;\r\n\t\t// 若选项id相同则更新content\r\n\t\tconst newOptions = options.map(option => option.id === id ? {...option, content: e.target.value} : option);\r\n\t\tsetOptions(newOptions);\r\n\t\t// ...sessionStorage\r\n\t\tconst data = {\r\n\t\t\ttitle: question,\r\n\t\t\toptions: newOptions,\r\n\t\t\ttype: 'single'\r\n\t\t}\r\n\t\tsessionStorage.setItem(`${question}`, JSON.stringify(data));\r\n\t}, [question, options]);\r\n\r\n\r\n\t// 编辑问题\r\n\tconst confirmEdit = useContext(ConfirmEditContext);\r\n\tconst cancelEdit = useContext(CancelEditContext);\r\n\tconst initialData = useContext(InitialDataContext);\r\n\r\n\t// 确认编辑\r\n\tfunction handleConfirmEdit(e) {\r\n\t\te.preventDefault();\r\n\t\tsessionStorage.removeItem('');\r\n\t\tconfirmEdit(question);\r\n\t}\r\n\r\n\t// 取消编辑\r\n\tfunction handleCancelEdit(e) {\r\n\t\te.preventDefault();\r\n\t\tsessionStorage.removeItem('');\r\n\t\tsessionStorage.removeItem(question);\r\n\t\tsessionStorage.setItem(editingQue, JSON.stringify(initialData));\r\n\t\tcancelEdit();\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\t// console.log(options);\r\n\t}, [options])\r\n\r\n\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t<input onChange={handleQuestionChange} placeholder={'请输入问题'}/>\r\n\t\t\t{/* 选项列表 */}\r\n\t\t\t<div>\r\n\t\t\t\t{options.map(\r\n\t\t\t\t\t(option, index) => (\r\n\t\t\t\t\t\t<div key={option.id}>\r\n\t\t\t\t\t\t\t<span>{option.id}</span>\r\n\t\t\t\t\t\t\t<input type=\"text\" id={option.id} value={option.content} onChange={handleOptionChange}\r\n\t\t\t\t\t\t\t\t\t\t placeholder={'请输入内容'}/>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t))}\r\n\t\t\t</div>\r\n\t\t\t<button onClick={addOption}>添加选项</button>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default Single;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}