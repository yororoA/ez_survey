{"ast":null,"code":"var _jsxFileName = \"E:\\\\Desktop\\\\\\u684C\\u9762\\\\\\u5DE5\\u4F5C\\\\\\u7F16\\u7A0B\\\\\\u524D\\u7AEF\\\\projext\\\\project\\\\src\\\\pages\\\\login.jsx\",\n  _s = $RefreshSig$();\nimport React, { useCallback, useContext, useEffect, useState } from 'react';\nimport { useRegisterUserMutation, useFindUserQuery, userApi } from \"../services/apis\";\nimport { Outlet } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Login = () => {\n  _s();\n  console.log(localStorage.getItem('documentId'));\n  const [entired, setEntired] = useState(false); // 是否全部填写\n  const [user, setUser] = useState(''); // 监测 user 输入框\n  const [pwd, setPWD] = useState(''); // 监测 pwd 输入框\n\n  // 使用 useCallback, 确保监测函数只在挂载时创建一次\n  const handleInputUser = useCallback(e => {\n    // user 监听器\n    setUser(e.target.value);\n  }, []);\n  const handleInputPWD = useCallback(e => {\n    // \tpwd 监听器\n    setPWD(e.target.value);\n  }, []);\n  const handleEntiredCheck = useCallback((user, pwd) => {\n    // 检查是否全部填写\n    return !!user && !!pwd;\n  }, []);\n  const preventSpaceInput = useCallback(e => {\n    if (e.key === ' ') {\n      e.preventDefault();\n    }\n  });\n\n  // 登陆状态管理\n  const [haslogin, setLogin] = useState(false);\n  // 注册处理\n  const [regis, regisResult] = useRegisterUserMutation();\n  // 注册处理器\n  // 发送请求到服务器的过程为异步, 需要时间传输数据并等待服务器处理, 若不使用异步, 代码会不等待请求完成直接继续执行, 导致无法正确获取服务器的返回结果\n  async function handleRegister(e) {\n    e.preventDefault();\n    if (!handleEntiredCheck(user, pwd)) {\n      console.log('请输入完整的用户名和密码');\n      return;\n    }\n    const data = {\n      attributes: {\n        username: user,\n        pwd\n      }\n    };\n    try {\n      // 调用注册api, 通过 unwrap 获取原始响应\n      const resp = await regis(data).unwrap();\n      console.log('注册成功\\n', resp);\n      localStorage.setItem('token', resp.data.documentId);\n      setLogin(true);\n    } catch (err) {\n      console.log('注册失败: ', err);\n    }\n  }\n\n  // 登录处理\n  async function handleLogin(e) {\n    e.preventDefault();\n    if (!handleEntiredCheck(user, pwd)) {\n      console.log('请输入完整的用户名和密码');\n    }\n    try {\n      const resp = await fetch('http://localhost:1337/api/clients/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          username: user,\n          pwd\n        })\n      });\n      if (!resp.ok) {\n        throw new Error(`登录失败: ${resp.status}`);\n      }\n      console.log('登录成功\\n', resp);\n      setLogin(true);\n      return await resp.json();\n    } catch (err) {\n      console.log('登录失败', err);\n    }\n  }\n  useEffect(() => {\n    setEntired(handleEntiredCheck(user, pwd));\n  }, [user, pwd, handleEntiredCheck]);\n\n  // 如果已登录, 渲染子路由, 否则重定向到登录页面\n  return haslogin ? /*#__PURE__*/_jsxDEV(Outlet, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 93,\n    columnNumber: 18\n  }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(\"form\", {\n      action: \"\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        onKeyDown: preventSpaceInput,\n        onChange: handleInputUser,\n        value: user,\n        placeholder: \"\\u7528\\u6237\\u540D\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        onKeyDown: preventSpaceInput,\n        onChange: handleInputPWD,\n        value: pwd,\n        placeholder: \"\\u8BF7\\u8F93\\u5165\\u5BC6\\u7801\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleLogin,\n        type: \"submit\",\n        children: \"\\u767B\\u5F55\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleRegister,\n        type: \"submit\",\n        children: \"\\u6CE8\\u518C\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 4\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 94,\n    columnNumber: 3\n  }, this);\n};\n_s(Login, \"x+kvAHsjllCFcnL9/RDxwvCM2/A=\", false, function () {\n  return [useRegisterUserMutation];\n});\n_c = Login;\nexport default Login;\nvar _c;\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"names":["React","useCallback","useContext","useEffect","useState","useRegisterUserMutation","useFindUserQuery","userApi","Outlet","jsxDEV","_jsxDEV","Login","_s","console","log","localStorage","getItem","entired","setEntired","user","setUser","pwd","setPWD","handleInputUser","e","target","value","handleInputPWD","handleEntiredCheck","preventSpaceInput","key","preventDefault","haslogin","setLogin","regis","regisResult","handleRegister","data","attributes","username","resp","unwrap","setItem","documentId","err","handleLogin","fetch","method","headers","body","JSON","stringify","ok","Error","status","json","fileName","_jsxFileName","lineNumber","columnNumber","children","action","type","onKeyDown","onChange","placeholder","onClick","_c","$RefreshReg$"],"sources":["E:/Desktop/桌面/工作/编程/前端/projext/project/src/pages/login.jsx"],"sourcesContent":["import React, {useCallback, useContext, useEffect, useState} from 'react';\r\nimport {useRegisterUserMutation, useFindUserQuery, userApi} from \"../services/apis\";\r\nimport {Outlet} from \"react-router-dom\";\r\n\r\n\r\nconst Login = () => {\r\n\tconsole.log(localStorage.getItem('documentId'))\r\n\r\n\r\n\tconst [entired, setEntired] = useState(false); // 是否全部填写\r\n\tconst [user, setUser] = useState(''); // 监测 user 输入框\r\n\tconst [pwd, setPWD] = useState(''); // 监测 pwd 输入框\r\n\r\n\t// 使用 useCallback, 确保监测函数只在挂载时创建一次\r\n\tconst handleInputUser = useCallback((e) => {\r\n\t\t// user 监听器\r\n\t\tsetUser(e.target.value);\r\n\t}, []);\r\n\tconst handleInputPWD = useCallback((e) => {\r\n\t\t// \tpwd 监听器\r\n\t\tsetPWD(e.target.value);\r\n\t}, []);\r\n\tconst handleEntiredCheck = useCallback((user, pwd) => {\r\n\t\t// 检查是否全部填写\r\n\t\treturn (!!user && !!pwd);\r\n\t}, [])\r\n\tconst preventSpaceInput = useCallback((e)=>{\r\n\t\tif(e.key === ' '){\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t})\r\n\r\n\t// 登陆状态管理\r\n\tconst [haslogin, setLogin] = useState(false);\r\n\t// 注册处理\r\n\tconst [regis, regisResult] = useRegisterUserMutation();\r\n\t// 注册处理器\r\n\t// 发送请求到服务器的过程为异步, 需要时间传输数据并等待服务器处理, 若不使用异步, 代码会不等待请求完成直接继续执行, 导致无法正确获取服务器的返回结果\r\n\tasync function handleRegister(e) {\r\n\t\te.preventDefault();\r\n\t\tif (!handleEntiredCheck(user, pwd)) {\r\n\t\t\tconsole.log('请输入完整的用户名和密码');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst data = {\r\n\t\t\tattributes: {\r\n\t\t\t\tusername: user,\r\n\t\t\t\tpwd\r\n\t\t\t}\r\n\t\t}\r\n\t\ttry {\r\n\t\t\t// 调用注册api, 通过 unwrap 获取原始响应\r\n\t\t\tconst resp = await regis(data).unwrap();\r\n\t\t\tconsole.log('注册成功\\n', resp);\r\n\t\t\tlocalStorage.setItem('token', resp.data.documentId);\r\n\t\t\tsetLogin(true);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.log('注册失败: ', err);\r\n\t\t}\r\n\t}\r\n\r\n\t// 登录处理\r\n\tasync function handleLogin(e) {\r\n\t\te.preventDefault();\r\n\t\tif (!handleEntiredCheck(user, pwd)) {\r\n\t\t\tconsole.log('请输入完整的用户名和密码')\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tconst resp = await fetch('http://localhost:1337/api/clients/login', {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t},\r\n\t\t\t\tbody: JSON.stringify({username: user, pwd}),\r\n\t\t\t});\r\n\t\t\tif(!resp.ok){\r\n\t\t\t\tthrow new Error(`登录失败: ${resp.status}`)\r\n\t\t\t}\r\n\t\t\tconsole.log('登录成功\\n',resp)\r\n\t\t\tsetLogin(true);\r\n\t\t\treturn await resp.json();\r\n\t\t} catch (err) {\r\n\t\t\tconsole.log('登录失败', err);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tuseEffect(() => {\r\n\t\tsetEntired(handleEntiredCheck(user, pwd));\r\n\t}, [user, pwd, handleEntiredCheck]);\r\n\r\n\t// 如果已登录, 渲染子路由, 否则重定向到登录页面\r\n\treturn haslogin?<Outlet/>:(\r\n\t\t<div>\r\n\t\t\t<form action=\"\">\r\n\t\t\t\t<input type=\"text\" onKeyDown={preventSpaceInput} onChange={handleInputUser} value={user} placeholder=\"用户名\"/>\r\n\t\t\t\t<input type=\"text\" onKeyDown={preventSpaceInput} onChange={handleInputPWD} value={pwd} placeholder=\"请输入密码\"/>\r\n\t\t\t\t<button onClick={handleLogin} type=\"submit\">登录</button>\r\n\t\t\t\t<button onClick={handleRegister} type=\"submit\">注册</button>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default Login;"],"mappings":";;AAAA,OAAOA,KAAK,IAAGC,WAAW,EAAEC,UAAU,EAAEC,SAAS,EAAEC,QAAQ,QAAO,OAAO;AACzE,SAAQC,uBAAuB,EAAEC,gBAAgB,EAAEC,OAAO,QAAO,kBAAkB;AACnF,SAAQC,MAAM,QAAO,kBAAkB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAGxC,MAAMC,KAAK,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACnBC,OAAO,CAACC,GAAG,CAACC,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC,CAAC;EAG/C,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAGd,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;EAC/C,MAAM,CAACe,IAAI,EAAEC,OAAO,CAAC,GAAGhB,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC;EACtC,MAAM,CAACiB,GAAG,EAAEC,MAAM,CAAC,GAAGlB,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC;;EAEpC;EACA,MAAMmB,eAAe,GAAGtB,WAAW,CAAEuB,CAAC,IAAK;IAC1C;IACAJ,OAAO,CAACI,CAAC,CAACC,MAAM,CAACC,KAAK,CAAC;EACxB,CAAC,EAAE,EAAE,CAAC;EACN,MAAMC,cAAc,GAAG1B,WAAW,CAAEuB,CAAC,IAAK;IACzC;IACAF,MAAM,CAACE,CAAC,CAACC,MAAM,CAACC,KAAK,CAAC;EACvB,CAAC,EAAE,EAAE,CAAC;EACN,MAAME,kBAAkB,GAAG3B,WAAW,CAAC,CAACkB,IAAI,EAAEE,GAAG,KAAK;IACrD;IACA,OAAQ,CAAC,CAACF,IAAI,IAAI,CAAC,CAACE,GAAG;EACxB,CAAC,EAAE,EAAE,CAAC;EACN,MAAMQ,iBAAiB,GAAG5B,WAAW,CAAEuB,CAAC,IAAG;IAC1C,IAAGA,CAAC,CAACM,GAAG,KAAK,GAAG,EAAC;MAChBN,CAAC,CAACO,cAAc,CAAC,CAAC;IACnB;EACD,CAAC,CAAC;;EAEF;EACA,MAAM,CAACC,QAAQ,EAAEC,QAAQ,CAAC,GAAG7B,QAAQ,CAAC,KAAK,CAAC;EAC5C;EACA,MAAM,CAAC8B,KAAK,EAAEC,WAAW,CAAC,GAAG9B,uBAAuB,CAAC,CAAC;EACtD;EACA;EACA,eAAe+B,cAAcA,CAACZ,CAAC,EAAE;IAChCA,CAAC,CAACO,cAAc,CAAC,CAAC;IAClB,IAAI,CAACH,kBAAkB,CAACT,IAAI,EAAEE,GAAG,CAAC,EAAE;MACnCR,OAAO,CAACC,GAAG,CAAC,cAAc,CAAC;MAC3B;IACD;IACA,MAAMuB,IAAI,GAAG;MACZC,UAAU,EAAE;QACXC,QAAQ,EAAEpB,IAAI;QACdE;MACD;IACD,CAAC;IACD,IAAI;MACH;MACA,MAAMmB,IAAI,GAAG,MAAMN,KAAK,CAACG,IAAI,CAAC,CAACI,MAAM,CAAC,CAAC;MACvC5B,OAAO,CAACC,GAAG,CAAC,QAAQ,EAAE0B,IAAI,CAAC;MAC3BzB,YAAY,CAAC2B,OAAO,CAAC,OAAO,EAAEF,IAAI,CAACH,IAAI,CAACM,UAAU,CAAC;MACnDV,QAAQ,CAAC,IAAI,CAAC;IACf,CAAC,CAAC,OAAOW,GAAG,EAAE;MACb/B,OAAO,CAACC,GAAG,CAAC,QAAQ,EAAE8B,GAAG,CAAC;IAC3B;EACD;;EAEA;EACA,eAAeC,WAAWA,CAACrB,CAAC,EAAE;IAC7BA,CAAC,CAACO,cAAc,CAAC,CAAC;IAClB,IAAI,CAACH,kBAAkB,CAACT,IAAI,EAAEE,GAAG,CAAC,EAAE;MACnCR,OAAO,CAACC,GAAG,CAAC,cAAc,CAAC;IAC5B;IACA,IAAI;MACH,MAAM0B,IAAI,GAAG,MAAMM,KAAK,CAAC,yCAAyC,EAAE;QACnEC,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UACR,cAAc,EAAE;QACjB,CAAC;QACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;UAACZ,QAAQ,EAAEpB,IAAI;UAAEE;QAAG,CAAC;MAC3C,CAAC,CAAC;MACF,IAAG,CAACmB,IAAI,CAACY,EAAE,EAAC;QACX,MAAM,IAAIC,KAAK,CAAC,SAASb,IAAI,CAACc,MAAM,EAAE,CAAC;MACxC;MACAzC,OAAO,CAACC,GAAG,CAAC,QAAQ,EAAC0B,IAAI,CAAC;MAC1BP,QAAQ,CAAC,IAAI,CAAC;MACd,OAAO,MAAMO,IAAI,CAACe,IAAI,CAAC,CAAC;IACzB,CAAC,CAAC,OAAOX,GAAG,EAAE;MACb/B,OAAO,CAACC,GAAG,CAAC,MAAM,EAAE8B,GAAG,CAAC;IACzB;EACD;EAGAzC,SAAS,CAAC,MAAM;IACfe,UAAU,CAACU,kBAAkB,CAACT,IAAI,EAAEE,GAAG,CAAC,CAAC;EAC1C,CAAC,EAAE,CAACF,IAAI,EAAEE,GAAG,EAAEO,kBAAkB,CAAC,CAAC;;EAEnC;EACA,OAAOI,QAAQ,gBAACtB,OAAA,CAACF,MAAM;IAAAgD,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAC,CAAC,gBACxBjD,OAAA;IAAAkD,QAAA,eACClD,OAAA;MAAMmD,MAAM,EAAC,EAAE;MAAAD,QAAA,gBACdlD,OAAA;QAAOoD,IAAI,EAAC,MAAM;QAACC,SAAS,EAAElC,iBAAkB;QAACmC,QAAQ,EAAEzC,eAAgB;QAACG,KAAK,EAAEP,IAAK;QAAC8C,WAAW,EAAC;MAAK;QAAAT,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAC,CAAC,eAC5GjD,OAAA;QAAOoD,IAAI,EAAC,MAAM;QAACC,SAAS,EAAElC,iBAAkB;QAACmC,QAAQ,EAAErC,cAAe;QAACD,KAAK,EAAEL,GAAI;QAAC4C,WAAW,EAAC;MAAO;QAAAT,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAC,CAAC,eAC5GjD,OAAA;QAAQwD,OAAO,EAAErB,WAAY;QAACiB,IAAI,EAAC,QAAQ;QAAAF,QAAA,EAAC;MAAE;QAAAJ,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC,eACvDjD,OAAA;QAAQwD,OAAO,EAAE9B,cAAe;QAAC0B,IAAI,EAAC,QAAQ;QAAAF,QAAA,EAAC;MAAE;QAAAJ,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACrD;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CACL;AACF,CAAC;AAAC/C,EAAA,CAjGID,KAAK;EAAA,QA8BmBN,uBAAuB;AAAA;AAAA8D,EAAA,GA9B/CxD,KAAK;AAmGX,eAAeA,KAAK;AAAC,IAAAwD,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}