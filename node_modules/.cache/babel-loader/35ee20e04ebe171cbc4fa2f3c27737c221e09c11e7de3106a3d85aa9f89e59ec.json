{"ast":null,"code":"var _jsxFileName = \"E:\\\\Desktop\\\\\\u684C\\u9762\\\\\\u5DE5\\u4F5C\\\\\\u7F16\\u7A0B\\\\\\u524D\\u7AEF\\\\projext\\\\project\\\\src\\\\pages\\\\main_nav_pages\\\\nav_pages\\\\drafts\\\\draftDisplay.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { getUserSurveys } from \"../../../../utils/getUserSurveys\";\nimport { RenderDraftsContext } from \"../../../../components/draftsDisplay/context/drafts\";\nimport RenderDrafts from \"../../../../components/draftsDisplay/renderDrafts\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst DraftDisplay = () => {\n  _s();\n  // 获取用户保存在草稿的问卷\n  const [drafts, setDrafts] = useState([]);\n\n  // 是否存在草稿\n  const [hasDraft, setHasDraft] = useState(false);\n  useEffect(() => {\n    try {\n      fetch(`http://localhost:1337/api/clients/${localStorage.getItem('token')}`).then(resp => {\n        if (!resp.ok) {\n          throw new Error(`获取用户数据失败: ${resp.status}`);\n        }\n        return resp.json();\n      }).then(data => {\n        const noSurveys = data.data.surveys == null || data.data.surveys.length === 0;\n        if (noSurveys) {\n          setHasDraft(false);\n          return;\n        }\n        const surveys = data.data.surveys.filter(survey => survey.published === false);\n        if (surveys == null || surveys.length === 0) {\n          setHasDraft(false);\n        } else {\n          setHasDraft(true);\n        }\n      });\n    } catch (err) {\n      console.error(err);\n    }\n  });\n  useEffect(() => {\n    // 获取草稿中问卷\n    if (hasDraft) getUserSurveys(true).then(r => setDrafts(r));\n  }, [hasDraft]);\n  return /*#__PURE__*/_jsxDEV(RenderDraftsContext.Provider, {\n    value: drafts,\n    children: /*#__PURE__*/_jsxDEV(RenderDrafts, {\n      hasDraft: hasDraft\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 4\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 48,\n    columnNumber: 3\n  }, this);\n};\n_s(DraftDisplay, \"5EfIOBqSS+M0BGV8925jyvWtV/g=\");\n_c = DraftDisplay;\nexport default DraftDisplay;\nvar _c;\n$RefreshReg$(_c, \"DraftDisplay\");","map":{"version":3,"names":["React","useEffect","useState","getUserSurveys","RenderDraftsContext","RenderDrafts","jsxDEV","_jsxDEV","DraftDisplay","_s","drafts","setDrafts","hasDraft","setHasDraft","fetch","localStorage","getItem","then","resp","ok","Error","status","json","data","noSurveys","surveys","length","filter","survey","published","err","console","error","r","Provider","value","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["E:/Desktop/桌面/工作/编程/前端/projext/project/src/pages/main_nav_pages/nav_pages/drafts/draftDisplay.jsx"],"sourcesContent":["import React, {useEffect, useState} from 'react';\r\nimport {getUserSurveys} from \"../../../../utils/getUserSurveys\";\r\nimport {RenderDraftsContext} from \"../../../../components/draftsDisplay/context/drafts\";\r\nimport RenderDrafts from \"../../../../components/draftsDisplay/renderDrafts\";\r\n\r\nconst DraftDisplay = () => {\r\n\t// 获取用户保存在草稿的问卷\r\n\tconst [drafts, setDrafts] = useState([]);\r\n\r\n\r\n\t// 是否存在草稿\r\n\tconst [hasDraft, setHasDraft] = useState(false);\r\n\tuseEffect(() => {\r\n\t\ttry {\r\n\t\t\tfetch(`http://localhost:1337/api/clients/${localStorage.getItem('token')}`)\r\n\t\t\t\t.then(resp => {\r\n\t\t\t\t\tif (!resp.ok) {\r\n\t\t\t\t\t\tthrow new Error(`获取用户数据失败: ${resp.status}`);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn resp.json();\r\n\t\t\t\t})\r\n\t\t\t\t.then(data => {\r\n\t\t\t\t\tconst noSurveys = data.data.surveys == null || data.data.surveys.length === 0;\r\n\t\t\t\t\tif (noSurveys) {\r\n\t\t\t\t\t\tsetHasDraft(false);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst surveys = data.data.surveys.filter(survey => survey.published === false);\r\n\t\t\t\t\tif (surveys == null || surveys.length === 0) {\r\n\t\t\t\t\t\tsetHasDraft(false);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsetHasDraft(true);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t}\r\n\t})\r\n\r\n\r\n\tuseEffect(() => {\r\n\t\t// 获取草稿中问卷\r\n\t\tif (hasDraft) getUserSurveys(true).then(r => setDrafts(r));\r\n\t}, [hasDraft]);\r\n\r\n\r\n\treturn (\r\n\t\t<RenderDraftsContext.Provider value={drafts}>\r\n\t\t\t<RenderDrafts hasDraft={hasDraft}/>\r\n\t\t</RenderDraftsContext.Provider>\r\n\t);\r\n};\r\n\r\nexport default DraftDisplay;"],"mappings":";;AAAA,OAAOA,KAAK,IAAGC,SAAS,EAAEC,QAAQ,QAAO,OAAO;AAChD,SAAQC,cAAc,QAAO,kCAAkC;AAC/D,SAAQC,mBAAmB,QAAO,qDAAqD;AACvF,OAAOC,YAAY,MAAM,mDAAmD;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE7E,MAAMC,YAAY,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAC1B;EACA,MAAM,CAACC,MAAM,EAAEC,SAAS,CAAC,GAAGT,QAAQ,CAAC,EAAE,CAAC;;EAGxC;EACA,MAAM,CAACU,QAAQ,EAAEC,WAAW,CAAC,GAAGX,QAAQ,CAAC,KAAK,CAAC;EAC/CD,SAAS,CAAC,MAAM;IACf,IAAI;MACHa,KAAK,CAAC,qCAAqCC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CACzEC,IAAI,CAACC,IAAI,IAAI;QACb,IAAI,CAACA,IAAI,CAACC,EAAE,EAAE;UACb,MAAM,IAAIC,KAAK,CAAC,aAAaF,IAAI,CAACG,MAAM,EAAE,CAAC;QAC5C;QACA,OAAOH,IAAI,CAACI,IAAI,CAAC,CAAC;MACnB,CAAC,CAAC,CACDL,IAAI,CAACM,IAAI,IAAI;QACb,MAAMC,SAAS,GAAGD,IAAI,CAACA,IAAI,CAACE,OAAO,IAAI,IAAI,IAAIF,IAAI,CAACA,IAAI,CAACE,OAAO,CAACC,MAAM,KAAK,CAAC;QAC7E,IAAIF,SAAS,EAAE;UACdX,WAAW,CAAC,KAAK,CAAC;UAClB;QACD;QACA,MAAMY,OAAO,GAAGF,IAAI,CAACA,IAAI,CAACE,OAAO,CAACE,MAAM,CAACC,MAAM,IAAIA,MAAM,CAACC,SAAS,KAAK,KAAK,CAAC;QAC9E,IAAIJ,OAAO,IAAI,IAAI,IAAIA,OAAO,CAACC,MAAM,KAAK,CAAC,EAAE;UAC5Cb,WAAW,CAAC,KAAK,CAAC;QACnB,CAAC,MAAM;UACNA,WAAW,CAAC,IAAI,CAAC;QAClB;MACD,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOiB,GAAG,EAAE;MACbC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC;IACnB;EACD,CAAC,CAAC;EAGF7B,SAAS,CAAC,MAAM;IACf;IACA,IAAIW,QAAQ,EAAET,cAAc,CAAC,IAAI,CAAC,CAACc,IAAI,CAACgB,CAAC,IAAItB,SAAS,CAACsB,CAAC,CAAC,CAAC;EAC3D,CAAC,EAAE,CAACrB,QAAQ,CAAC,CAAC;EAGd,oBACCL,OAAA,CAACH,mBAAmB,CAAC8B,QAAQ;IAACC,KAAK,EAAEzB,MAAO;IAAA0B,QAAA,eAC3C7B,OAAA,CAACF,YAAY;MAACO,QAAQ,EAAEA;IAAS;MAAAyB,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAC;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACN,CAAC;AAEjC,CAAC;AAAC/B,EAAA,CA9CID,YAAY;AAAAiC,EAAA,GAAZjC,YAAY;AAgDlB,eAAeA,YAAY;AAAC,IAAAiC,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}