{"ast":null,"code":"var _jsxFileName = \"E:\\\\Desktop\\\\\\u684C\\u9762\\\\\\u5DE5\\u4F5C\\\\\\u7F16\\u7A0B\\\\\\u524D\\u7AEF\\\\projext\\\\project\\\\src\\\\pages\\\\main_nav_pages\\\\nav_pages\\\\draft.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { getUserSurveys } from \"../../../utils/getUserSurveys\";\nimport { RenderDraftsContext } from \"../../../components/draftsDisplay/context/drafts\";\nimport RenderDrafts from \"../../../components/draftsDisplay/renderDrafts\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Draft = () => {\n  _s();\n  // 获取用户保存在草稿的问卷\n  const [drafts, setDrafts] = useState([]);\n\n  // 是否存在草稿\n  const [hasDraft, setHasDraft] = useState(false);\n  try {\n    fetch(`http://localhost:1337/api/clients/${localStorage.getItem('token')}`).then(resp => {\n      if (!resp.ok) {\n        throw new Error(`获取用户数据失败: ${resp.status}`);\n      }\n      return resp.json();\n    }).then(data => {\n      const surveys = data.data.surveys.filter(survey => survey.published === false);\n      if (surveys == null || surveys.length === 0) {\n        setHasDraft(false);\n      } else {\n        setHasDraft(true);\n      }\n    });\n  } catch (err) {\n    console.error(err);\n  }\n  useEffect(() => {\n    // 获取草稿中问卷\n    if (hasDraft) getUserSurveys(true).then(r => setDrafts(r));\n  }, [hasDraft]);\n  return /*#__PURE__*/_jsxDEV(RenderDraftsContext.Provider, {\n    value: drafts,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [hasDraft && /*#__PURE__*/_jsxDEV(RenderDrafts, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 43,\n        columnNumber: 18\n      }, this), !hasDraft && /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: '暂无草稿, 快去编辑一份吧'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 44,\n        columnNumber: 19\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 42,\n      columnNumber: 4\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 41,\n    columnNumber: 3\n  }, this);\n};\n_s(Draft, \"0isVIjVpz68I47JMHr7Yc//KRso=\");\n_c = Draft;\nexport default Draft;\nvar _c;\n$RefreshReg$(_c, \"Draft\");","map":{"version":3,"names":["React","useEffect","useState","getUserSurveys","RenderDraftsContext","RenderDrafts","jsxDEV","_jsxDEV","Draft","_s","drafts","setDrafts","hasDraft","setHasDraft","fetch","localStorage","getItem","then","resp","ok","Error","status","json","data","surveys","filter","survey","published","length","err","console","error","r","Provider","value","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["E:/Desktop/桌面/工作/编程/前端/projext/project/src/pages/main_nav_pages/nav_pages/draft.jsx"],"sourcesContent":["import React, {useEffect, useState} from 'react';\r\nimport {getUserSurveys} from \"../../../utils/getUserSurveys\";\r\nimport {RenderDraftsContext} from \"../../../components/draftsDisplay/context/drafts\";\r\nimport RenderDrafts from \"../../../components/draftsDisplay/renderDrafts\";\r\n\r\nconst Draft = () => {\r\n\t// 获取用户保存在草稿的问卷\r\n\tconst [drafts, setDrafts] = useState([]);\r\n\r\n\r\n\t// 是否存在草稿\r\n\tconst [hasDraft, setHasDraft] = useState(false);\r\n\ttry {\r\n\t\tfetch(`http://localhost:1337/api/clients/${localStorage.getItem('token')}`)\r\n\t\t\t.then(resp => {\r\n\t\t\t\tif (!resp.ok) {\r\n\t\t\t\t\tthrow new Error(`获取用户数据失败: ${resp.status}`);\r\n\t\t\t\t}\r\n\t\t\t\treturn resp.json();\r\n\t\t\t})\r\n\t\t\t.then(data => {\r\n\t\t\t\tconst surveys = data.data.surveys.filter(survey => survey.published===false);\r\n\t\t\t\tif (surveys == null || surveys.length === 0) {\r\n\t\t\t\t\tsetHasDraft(false);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsetHasDraft(true);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t} catch (err) {\r\n\t\tconsole.error(err);\r\n\t}\r\n\r\n\r\n\tuseEffect(() => {\r\n\t\t// 获取草稿中问卷\r\n\t\tif (hasDraft) getUserSurveys(true).then(r => setDrafts(r));\r\n\t}, [hasDraft]);\r\n\r\n\r\n\treturn (\r\n\t\t<RenderDraftsContext.Provider value={drafts}>\r\n\t\t\t<div>\r\n\t\t\t\t{hasDraft && <RenderDrafts/>}\r\n\t\t\t\t{!hasDraft && <h1>{'暂无草稿, 快去编辑一份吧'}</h1>}\r\n\t\t\t</div>\r\n\t\t</RenderDraftsContext.Provider>\r\n\t);\r\n};\r\n\r\nexport default Draft;\r\n\r\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAGC,SAAS,EAAEC,QAAQ,QAAO,OAAO;AAChD,SAAQC,cAAc,QAAO,+BAA+B;AAC5D,SAAQC,mBAAmB,QAAO,kDAAkD;AACpF,OAAOC,YAAY,MAAM,gDAAgD;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE1E,MAAMC,KAAK,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACnB;EACA,MAAM,CAACC,MAAM,EAAEC,SAAS,CAAC,GAAGT,QAAQ,CAAC,EAAE,CAAC;;EAGxC;EACA,MAAM,CAACU,QAAQ,EAAEC,WAAW,CAAC,GAAGX,QAAQ,CAAC,KAAK,CAAC;EAC/C,IAAI;IACHY,KAAK,CAAC,qCAAqCC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CACzEC,IAAI,CAACC,IAAI,IAAI;MACb,IAAI,CAACA,IAAI,CAACC,EAAE,EAAE;QACb,MAAM,IAAIC,KAAK,CAAC,aAAaF,IAAI,CAACG,MAAM,EAAE,CAAC;MAC5C;MACA,OAAOH,IAAI,CAACI,IAAI,CAAC,CAAC;IACnB,CAAC,CAAC,CACDL,IAAI,CAACM,IAAI,IAAI;MACb,MAAMC,OAAO,GAAGD,IAAI,CAACA,IAAI,CAACC,OAAO,CAACC,MAAM,CAACC,MAAM,IAAIA,MAAM,CAACC,SAAS,KAAG,KAAK,CAAC;MAC5E,IAAIH,OAAO,IAAI,IAAI,IAAIA,OAAO,CAACI,MAAM,KAAK,CAAC,EAAE;QAC5Cf,WAAW,CAAC,KAAK,CAAC;MACnB,CAAC,MAAM;QACNA,WAAW,CAAC,IAAI,CAAC;MAClB;IACD,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOgB,GAAG,EAAE;IACbC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC;EACnB;EAGA5B,SAAS,CAAC,MAAM;IACf;IACA,IAAIW,QAAQ,EAAET,cAAc,CAAC,IAAI,CAAC,CAACc,IAAI,CAACe,CAAC,IAAIrB,SAAS,CAACqB,CAAC,CAAC,CAAC;EAC3D,CAAC,EAAE,CAACpB,QAAQ,CAAC,CAAC;EAGd,oBACCL,OAAA,CAACH,mBAAmB,CAAC6B,QAAQ;IAACC,KAAK,EAAExB,MAAO;IAAAyB,QAAA,eAC3C5B,OAAA;MAAA4B,QAAA,GACEvB,QAAQ,iBAAIL,OAAA,CAACF,YAAY;QAAA+B,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAC,CAAC,EAC3B,CAAC3B,QAAQ,iBAAIL,OAAA;QAAA4B,QAAA,EAAK;MAAe;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAK,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACpC;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACuB,CAAC;AAEjC,CAAC;AAAC9B,EAAA,CA1CID,KAAK;AAAAgC,EAAA,GAALhC,KAAK;AA4CX,eAAeA,KAAK;AAAC,IAAAgC,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}