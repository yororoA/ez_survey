{"ast":null,"code":"var _jsxFileName = \"E:\\\\Desktop\\\\\\u684C\\u9762\\\\\\u5DE5\\u4F5C\\\\\\u7F16\\u7A0B\\\\\\u524D\\u7AEF\\\\projext\\\\project\\\\src\\\\pages\\\\login.jsx\",\n  _s = $RefreshSig$();\nimport React, { useCallback, useContext, useEffect, useState } from 'react';\nimport { useRegisterUserMutation, useFindUserQuery, userApi } from \"../services/apis\";\nimport { Outlet } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Login = () => {\n  _s();\n  const [entired, setEntired] = useState(false); // 是否全部填写\n  const [user, setUser] = useState(''); // 监测 user 输入框\n  const [pwd, setPWD] = useState(''); // 监测 pwd 输入框\n\n  // 使用 useCallback, 确保监测函数只在挂载时创建一次\n  const handleInputUser = useCallback(e => {\n    // user 监听器\n    setUser(e.target.value);\n  }, []);\n  const handleInputPWD = useCallback(e => {\n    // \tpwd 监听器\n    setPWD(e.target.value);\n  }, []);\n  const handleEntiredCheck = useCallback((user, pwd) => {\n    // 检查是否全部填写\n    return !!user && !!pwd;\n  }, []);\n  const preventSpaceInput = useCallback(e => {\n    console.log(e.key === ' ');\n  });\n\n  // 登陆状态管理\n  const [haslogin, setLogin] = useState(false);\n  // 注册处理\n  const [regis, regisResult] = useRegisterUserMutation();\n  // 注册处理器\n  // 发送请求到服务器的过程为异步, 需要时间传输数据并等待服务器处理, 若不使用异步, 代码会不等待请求完成直接继续执行, 导致无法正确获取服务器的返回结果\n  async function handleRegister(e) {\n    e.preventDefault();\n    if (!handleEntiredCheck(user, pwd)) {\n      console.log('请输入完整的用户名和密码');\n      return;\n    }\n    const data = {\n      attributes: {\n        username: user,\n        pwd\n      }\n    };\n    try {\n      // 调用注册api, 通过 unwrap 获取原始响应\n      const resp = await regis(data).unwrap();\n      console.log('注册成功\\n', resp);\n      localStorage.setItem('token', resp.data.documentId);\n      // setLogin(true);\n    } catch (err) {\n      console.log('注册失败: ', err);\n    }\n  }\n\n  // 登录处理\n  async function handleLogin(e) {\n    e.preventDefault();\n    if (!handleEntiredCheck(user, pwd)) {\n      console.log('请输入完整的用户名和密码');\n    }\n    try {\n      const resp = await fetch('http://localhost:1337/api/clients/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          username: user,\n          pwd\n        })\n      });\n      if (!resp.ok) {\n        throw new Error(`登录失败: ${resp.status}`);\n      }\n      console.log('登录成功\\n', resp);\n      // setLogin(true);\n      return await resp.json();\n    } catch (err) {\n      console.log('登录失败', err);\n    }\n  }\n  useEffect(() => {\n    setEntired(handleEntiredCheck(user, pwd));\n  }, [user, pwd, handleEntiredCheck]);\n\n  // 如果已登录, 渲染子路由, 否则重定向到登录页面\n  return haslogin ? /*#__PURE__*/_jsxDEV(Outlet, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 88,\n    columnNumber: 18\n  }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(\"form\", {\n      action: \"\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        onKeyDown: preventSpaceInput,\n        onChange: handleInputUser,\n        value: user,\n        placeholder: \"\\u7528\\u6237\\u540D\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        onKeyDown: preventSpaceInput,\n        onChange: handleInputPWD,\n        value: pwd,\n        placeholder: \"\\u8BF7\\u8F93\\u5165\\u5BC6\\u7801\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleLogin,\n        type: \"submit\",\n        children: \"\\u767B\\u5F55\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleRegister,\n        type: \"submit\",\n        children: \"\\u6CE8\\u518C\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 4\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 89,\n    columnNumber: 3\n  }, this);\n};\n_s(Login, \"x+kvAHsjllCFcnL9/RDxwvCM2/A=\", false, function () {\n  return [useRegisterUserMutation];\n});\n_c = Login;\nexport default Login;\nvar _c;\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"names":["React","useCallback","useContext","useEffect","useState","useRegisterUserMutation","useFindUserQuery","userApi","Outlet","jsxDEV","_jsxDEV","Login","_s","entired","setEntired","user","setUser","pwd","setPWD","handleInputUser","e","target","value","handleInputPWD","handleEntiredCheck","preventSpaceInput","console","log","key","haslogin","setLogin","regis","regisResult","handleRegister","preventDefault","data","attributes","username","resp","unwrap","localStorage","setItem","documentId","err","handleLogin","fetch","method","headers","body","JSON","stringify","ok","Error","status","json","fileName","_jsxFileName","lineNumber","columnNumber","children","action","type","onKeyDown","onChange","placeholder","onClick","_c","$RefreshReg$"],"sources":["E:/Desktop/桌面/工作/编程/前端/projext/project/src/pages/login.jsx"],"sourcesContent":["import React, {useCallback, useContext, useEffect, useState} from 'react';\r\nimport {useRegisterUserMutation, useFindUserQuery, userApi} from \"../services/apis\";\r\nimport {Outlet} from \"react-router-dom\";\r\n\r\n\r\nconst Login = () => {\r\n\tconst [entired, setEntired] = useState(false); // 是否全部填写\r\n\tconst [user, setUser] = useState(''); // 监测 user 输入框\r\n\tconst [pwd, setPWD] = useState(''); // 监测 pwd 输入框\r\n\r\n\t// 使用 useCallback, 确保监测函数只在挂载时创建一次\r\n\tconst handleInputUser = useCallback((e) => {\r\n\t\t// user 监听器\r\n\t\tsetUser(e.target.value);\r\n\t}, []);\r\n\tconst handleInputPWD = useCallback((e) => {\r\n\t\t// \tpwd 监听器\r\n\t\tsetPWD(e.target.value);\r\n\t}, []);\r\n\tconst handleEntiredCheck = useCallback((user, pwd) => {\r\n\t\t// 检查是否全部填写\r\n\t\treturn (!!user && !!pwd);\r\n\t}, [])\r\n\tconst preventSpaceInput = useCallback((e)=>{\r\n\t\tconsole.log(e.key === ' ')\r\n\t})\r\n\r\n\t// 登陆状态管理\r\n\tconst [haslogin, setLogin] = useState(false);\r\n\t// 注册处理\r\n\tconst [regis, regisResult] = useRegisterUserMutation();\r\n\t// 注册处理器\r\n\t// 发送请求到服务器的过程为异步, 需要时间传输数据并等待服务器处理, 若不使用异步, 代码会不等待请求完成直接继续执行, 导致无法正确获取服务器的返回结果\r\n\tasync function handleRegister(e) {\r\n\t\te.preventDefault();\r\n\t\tif (!handleEntiredCheck(user, pwd)) {\r\n\t\t\tconsole.log('请输入完整的用户名和密码');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst data = {\r\n\t\t\tattributes: {\r\n\t\t\t\tusername: user,\r\n\t\t\t\tpwd\r\n\t\t\t}\r\n\t\t}\r\n\t\ttry {\r\n\t\t\t// 调用注册api, 通过 unwrap 获取原始响应\r\n\t\t\tconst resp = await regis(data).unwrap();\r\n\t\t\tconsole.log('注册成功\\n', resp);\r\n\t\t\tlocalStorage.setItem('token', resp.data.documentId);\r\n\t\t\t// setLogin(true);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.log('注册失败: ', err);\r\n\t\t}\r\n\t}\r\n\r\n\t// 登录处理\r\n\tasync function handleLogin(e) {\r\n\t\te.preventDefault();\r\n\t\tif (!handleEntiredCheck(user, pwd)) {\r\n\t\t\tconsole.log('请输入完整的用户名和密码')\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tconst resp = await fetch('http://localhost:1337/api/clients/login', {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t},\r\n\t\t\t\tbody: JSON.stringify({username: user, pwd}),\r\n\t\t\t});\r\n\t\t\tif(!resp.ok){\r\n\t\t\t\tthrow new Error(`登录失败: ${resp.status}`)\r\n\t\t\t}\r\n\t\t\tconsole.log('登录成功\\n',resp)\r\n\t\t\t// setLogin(true);\r\n\t\t\treturn await resp.json();\r\n\t\t} catch (err) {\r\n\t\t\tconsole.log('登录失败', err);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tuseEffect(() => {\r\n\t\tsetEntired(handleEntiredCheck(user, pwd));\r\n\t}, [user, pwd, handleEntiredCheck]);\r\n\r\n\t// 如果已登录, 渲染子路由, 否则重定向到登录页面\r\n\treturn haslogin?<Outlet/>:(\r\n\t\t<div>\r\n\t\t\t<form action=\"\">\r\n\t\t\t\t<input type=\"text\" onKeyDown={preventSpaceInput} onChange={handleInputUser} value={user} placeholder=\"用户名\"/>\r\n\t\t\t\t<input type=\"text\" onKeyDown={preventSpaceInput} onChange={handleInputPWD} value={pwd} placeholder=\"请输入密码\"/>\r\n\t\t\t\t<button onClick={handleLogin} type=\"submit\">登录</button>\r\n\t\t\t\t<button onClick={handleRegister} type=\"submit\">注册</button>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default Login;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}