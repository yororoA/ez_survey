{"ast":null,"code":"var _jsxFileName = \"E:\\\\Desktop\\\\\\u684C\\u9762\\\\\\u5DE5\\u4F5C\\\\\\u7F16\\u7A0B\\\\\\u524D\\u7AEF\\\\projext\\\\project\\\\src\\\\pages\\\\main_nav_pages\\\\nav_pages\\\\edit.jsx\",\n  _s = $RefreshSig$();\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nimport QuesList from \"../../../components/editSurvey/quesList\";\nimport AddQue from \"../../../components/editSurvey/addQue\";\nimport { GetTitleContext } from \"../../../components/editSurvey/context/getTitleContext\";\nimport { useCreateQueMutation, useSaveSurveyMutation, useUpdateSurveyMutation } from \"../../../services/apis\";\nimport { filterQueDetails } from \"../../../components/editSurvey/filterQueDetails\";\nimport { CancelEditContext, ConfirmEditContext, EditingQueContext, InitialDataContext, IsEditingContext, ReEditQueContext } from \"../../../components/editSurvey/context/reEditQueContext\";\nimport { updateUser } from \"../../../utils/updateUser\";\nimport { useNavigate } from \"react-router-dom\";\nimport edit from '../../../style/edit/edit.module.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Edit = () => {\n  _s();\n  sessionStorage.clear();\n  const navigate = useNavigate();\n  // 监测是否正在添加某个问题\n  const [adding, setAdding] = useState(false);\n  // 正在添加的问题信息\n  const [addingTitle, setAddingTitle] = useState({});\n  // 是否添加完毕\n  const [addComplete, setAddComplete] = useState(false);\n  //  问题列表\n  const [ques, setQues] = useState([]);\n  // 检测是否保存或发布\n  const [draftOrPublish, setDraftOrPublish] = useState(false);\n\n  // 从草稿页面点击编辑跳转到publish时\n  // 检测sessionStorage中是否存在需要编辑的键值对, 若为null则不是从草稿页面跳转过来的\n  const storageSurveyTitle = sessionStorage.getItem('surveyTitleBefore');\n  const storageSurveyDescription = sessionStorage.getItem('surveyDescriptionBefore');\n  const isFromDrafts = storageSurveyTitle !== null || storageSurveyDescription !== null;\n\n  // 问卷标题\n  const [surveyTitle, setSurveyTitle] = useState(isFromDrafts ? storageSurveyTitle : '');\n  // 问卷描述\n  const [surveyDescr, setSurveyDescr] = useState(isFromDrafts ? storageSurveyDescription : '');\n  useEffect(() => {\n    if (isFromDrafts) {\n      // 如果跳转自drafts的编辑link\n      const nums = sessionStorage.length; // 相应draft从服务器拉取到本地的数据数目\n      const questionDatas = [];\n      for (let i = 0; i < nums; i++) {\n        // 读取每个数据的key, 若为题目key则存储在列表中, 用于之后上传给ques\n        const key = sessionStorage.key(i);\n        if (key === 'surveyTitleBefore' || key === 'surveyDescriptionBefore' || key === 'surveyTokenBefore' || key === 'queTokensBefore') {\n          continue;\n        }\n        const data = JSON.parse(sessionStorage.getItem(key));\n        questionDatas.push(data);\n      }\n      // 将data按index升序排序\n      questionDatas.sort((a, b) => a.index - b.index);\n      // 将所需数据传递给ques\n      const questions = [];\n      questionDatas.forEach(data => {\n        questions.push({\n          title: data.title,\n          type: data.type\n        });\n      });\n      setQues(questions);\n    }\n  }, [isFromDrafts]);\n\n  // 问卷标题\n  const handleTitleChange = useCallback(e => {\n    const newTitle = e.target.value;\n    setSurveyTitle(newTitle);\n    // 将标题存储到 sessionStorage\n    sessionStorage.setItem('surveyTitle', newTitle);\n  }, []);\n  // 问卷描述\n  const handleDescrChange = useCallback(e => {\n    const newDescr = e.target.value;\n    setSurveyDescr(newDescr);\n    // 将描述存储到 sessionStorage\n    sessionStorage.setItem('surveyDescription', newDescr);\n  }, []);\n\n  // 添加问题\n  const handleAddQue = useCallback(e => {\n    e.preventDefault();\n    setAdding(true);\n    setAddComplete(false);\n    setDraftOrPublish(false);\n    // 清除上一次草稿中保存的题目title, 避免因取消空标题的添加造成的清除前一个sessionStorage\n    setAddingTitle({\n      title: '',\n      id: Date.now()\n    });\n  }, [adding, addComplete]);\n  // 获得问题 title 用于定位 sessionStorage 中的存储\n  // 草稿---未确认添加\n  function draftTitle(title) {\n    console.log(title);\n    // 将获得的标题传给 addingTitle, 即正在使用的标题\n    setAddingTitle({\n      title,\n      id: Date.now()\n    });\n  }\n\n  // 确认添加---保存问题->ques\n  function saveTitle() {\n    if (addingTitle.title.length !== 0) {\n      const queType = JSON.parse(sessionStorage.getItem(addingTitle.title)).type;\n      setQues([...ques, {\n        ...addingTitle,\n        type: queType\n      }]);\n    } else {\n      alert('问题内容不可为空');\n    }\n  }\n\n  // 确认添加\n  const handleCompleteQue = e => {\n    e.preventDefault();\n    // 检查题目信息\n    const raw = sessionStorage.getItem(addingTitle.title);\n    if (!raw) {\n      alert('请先完善题目内容');\n      return;\n    }\n    const data = JSON.parse(raw);\n    const type = data === null || data === void 0 ? void 0 : data.type;\n    // 检查是否存在空选项（含仅空白）或没有选项\n    if (type === 'single' || type === 'checkbox') {\n      const options = Array.isArray(data.options) ? data.options : [];\n      const hasEmpty = options.some(opt => {\n        if (!opt) return true;\n        const content = typeof opt.content === 'string' ? opt.content.trim() : '';\n        return content.length === 0;\n      });\n      if (options.length === 0 || hasEmpty) {\n        alert('选项内容不可为空');\n        return;\n      }\n      saveTitle();\n      setAdding(false);\n      setAddComplete(true);\n      return;\n    }\n    saveTitle();\n    setAdding(false);\n    setAddComplete(true);\n  };\n\n  // 取消添加\n  const handleCancel = useCallback(e => {\n    e.preventDefault();\n    setAdding(false);\n    setAddComplete(false);\n    setDraftOrPublish(false);\n    // 取消添加时移除sessionStorage中存储的临时信息\n    sessionStorage.removeItem(addingTitle.title);\n    // 清空当前问题草稿\n    setAddingTitle({});\n  }, [adding, addComplete, addingTitle]);\n\n  // 编辑问题\n  const [queToEdit, setQueToEdit] = useState('');\n  const [isEditing, setIsEditing] = useState(false);\n  const [edintType, setEdingType] = useState(null);\n  const [editCompleted, setEditCompleted] = useState(false);\n  const [initialData, setInitialData] = useState(null);\n  const lastEditTitle = useRef('');\n\n  /*\r\n  * 编辑问题\r\n  * @title 需要编辑的问题title\r\n  * @deleteOrEdit Bool, true:delete, false:edit*/\n  function editQue(title, delteOrEdit) {\n    // 删除问题\n    if (delteOrEdit) {\n      setQues(prevQues => prevQues.filter(que => que.title !== title));\n      sessionStorage.removeItem(title);\n      setIsEditing(false);\n      setQueToEdit('');\n      return;\n    }\n    // 编辑问题\n    // 需要编辑的问题\n    const data = JSON.parse(sessionStorage.getItem(title));\n    console.log('点击编辑前的数据------', data);\n    const type = data.type;\n    setQueToEdit(title);\n    setIsEditing(true);\n    setEdingType(type);\n    // 将点击编辑前的数据保留下来\n    setInitialData(data);\n    lastEditTitle.current = title;\n  }\n\n  /*\r\n  * 确认编辑\r\n  * */\n  function confirmEdit(title) {\n    setQueToEdit(title);\n    setIsEditing(false);\n    setEditCompleted(true);\n    // 更新 ques\n    const newQues = ques;\n    newQues.forEach(que => {\n      if (que.title === lastEditTitle.current) {\n        que.title = title;\n        que.type = edintType;\n      }\n    });\n    setQues(newQues);\n  }\n\n  /*\r\n  * 取消编辑\r\n  * */\n  function cancelEdit() {\n    setQueToEdit('');\n    setIsEditing(false);\n    setEditCompleted(true);\n    // 重传 ques\n    setQues(ques);\n  }\n\n  // 将survey保存到草稿\n  const [doSaveDraft, {}] = useSaveSurveyMutation();\n  const [doSaveDraftQue, {}] = useCreateQueMutation();\n  const [doUpdateDraft, {}] = useUpdateSurveyMutation();\n  async function saveDraft(e) {\n    e.preventDefault();\n    // 1. 先上传survey的基础信息\n    const data = {\n      attributes: {\n        title: surveyTitle,\n        description: surveyDescr,\n        clientId: localStorage.getItem('token'),\n        published: false\n      }\n    };\n    if (!ques[0] || !surveyTitle || !surveyDescr) {\n      alert('问题不可为空!');\n      return;\n    }\n    try {\n      const resp = await doSaveDraft(data).unwrap();\n      console.log('保存问卷成功', resp);\n      // 将surveyToken临时储存在本地, 用于问题上传的绑定\n      sessionStorage.setItem('tempSurveyToken', resp.data.documentId);\n    } catch (err) {\n      console.log('保存draft失败', err);\n    }\n    const surveyToken = sessionStorage.getItem('tempSurveyToken');\n    // 将该survey绑定给创建问卷的用户\n    await updateUser('surveys', {\n      id: surveyToken,\n      published: false\n    }, false);\n    // 2. 上传问题信息并绑定survey\n    sessionStorage.removeItem(''); // 移除会话存储中的空白token\n    const queTokens = [];\n    for (const [index, que] of ques.entries()) {\n      const detail = filterQueDetails(que, index, surveyToken);\n      if (!detail) continue;\n      try {\n        const resp = await doSaveDraftQue(detail).unwrap();\n        console.log('保存问题成功', resp);\n        // 将queToken保存在数组中, 用于后续更新survey中的questions\n        queTokens.push(resp.data.documentId);\n      } catch (err) {\n        console.log('保存问题失败', err);\n      }\n    }\n    // 3. 更新survey中的questions\n    data.attributes.questions = JSON.stringify(queTokens);\n    try {\n      const resp = await doUpdateDraft(data).unwrap();\n      console.log('绑定问题成功', resp);\n    } catch (err) {\n      console.log('绑定问题失败', err);\n    }\n    // 3.5 移除原来的draft相关内容\n    if (isFromDrafts) {\n      try {\n        const resp = await fetch(`http://localhost:1337/api/clients/${localStorage.getItem('token')}`);\n        const result = await resp.json();\n        console.log(result);\n        const surveys = result.data.surveys;\n        const surveyTokenBefore = sessionStorage.getItem('surveyTokenBefore');\n        // 移除原survey绑定的question\n        const surveyResp = await fetch(`http://localhost:1337/api/surveys/${surveyTokenBefore}`);\n        const surveyResult = await surveyResp.json();\n        const quesBefore = surveyResult.data.questions;\n        for (const q of quesBefore) {\n          const qresp = await fetch(`http://localhost:1337/api/quests/${q}`, {\n            method: 'DELETE'\n          });\n          if (!resp.ok) {\n            console.error(`删除原问题失败: ${resp.status}`);\n          }\n        }\n        // 移除原survey\n        const delSurveyResp = await fetch(`http://localhost:1337/api/surveys/${surveyTokenBefore}`, {\n          method: 'DELETE'\n        });\n        if (!delSurveyResp.ok) {\n          console.error(`移除原survey失败: ${delSurveyResp.status}`);\n        }\n        // 移除绑定surveys中的原问卷id\n\n        surveys.forEach((survey, index) => {\n          if (survey.id === surveyTokenBefore) {\n            surveys.splice(index, 1);\n          }\n        });\n        // 将移除了原surveyId的surveys覆盖给client\n        await updateUser('surveys', surveys, true);\n      } catch (err) {\n        console.error(err);\n      }\n    }\n\n    // 4. 清除创建问卷产生的会话存储, 以免影响后续使用\n    sessionStorage.clear();\n    setDraftOrPublish(true);\n    // // 直接刷新页面, 绕开因清理sessionStorage可能造成的null错误\n    // window.location.reload();\n    navigate('../draft');\n  }\n\n  // 取消问卷\n  function cancelSurvey(e) {\n    e.preventDefault();\n    // 清除创建问卷产生的会话存储, 以免影响后续使用\n    sessionStorage.clear();\n    // 清理缓存\n    setQues([]);\n    setSurveyTitle('');\n    setSurveyDescr('');\n    if (isFromDrafts) navigate('../draft');\n  }\n  async function publishSurvey(e) {\n    e.preventDefault();\n    // 1. 先上传survey的基础信息\n    const data = {\n      attributes: {\n        title: surveyTitle,\n        description: surveyDescr,\n        clientId: localStorage.getItem('token'),\n        published: true,\n        endCollection: false\n      }\n    };\n    if (!ques[0] || !surveyTitle || !surveyDescr) {\n      alert('问题不可为空!');\n      return;\n    }\n    try {\n      const resp = await doSaveDraft(data).unwrap();\n      console.log('保存问卷成功', resp);\n      // 将surveyToken临时储存在本地, 用于问题上传的绑定\n      sessionStorage.setItem('tempSurveyToken', resp.data.documentId);\n    } catch (err) {\n      console.log('保存draft失败', err);\n    }\n    const surveyToken = sessionStorage.getItem('tempSurveyToken');\n    // 将该survey绑定给创建问卷的用户\n    await updateUser('surveys', {\n      id: surveyToken,\n      published: true\n    }, false);\n    // 2. 上传问题信息并绑定survey\n    sessionStorage.removeItem(''); // 移除会话存储中的空白token\n    const queTokens = [];\n    for (const [index, que] of ques.entries()) {\n      const detail = filterQueDetails(que, index, surveyToken);\n      if (!detail) continue;\n      try {\n        const resp = await doSaveDraftQue(detail).unwrap();\n        console.log('保存问题成功', resp);\n        // 将queToken保存在数组中, 用于后续更新survey中的questions\n        queTokens.push(resp.data.documentId);\n      } catch (err) {\n        console.log('保存问题失败', err);\n      }\n    }\n    // 3. 更新survey中的questions\n    data.attributes.questions = JSON.stringify(queTokens);\n    try {\n      const resp = await doUpdateDraft(data).unwrap();\n      console.log('绑定问题成功', resp);\n    } catch (err) {\n      console.log('绑定问题失败', err);\n    }\n    // 3.5 移除原来的draft相关内容\n    if (isFromDrafts) {\n      try {\n        const resp = await fetch(`http://localhost:1337/api/clients/${localStorage.getItem('token')}`);\n        const result = await resp.json();\n        console.log(result);\n        const surveys = result.data.surveys;\n        const surveyTokenBefore = sessionStorage.getItem('surveyTokenBefore');\n        // 移除原survey绑定的question\n        const surveyResp = await fetch(`http://localhost:1337/api/surveys/${surveyTokenBefore}`);\n        const surveyResult = await surveyResp.json();\n        const quesBefore = surveyResult.data.questions;\n        for (const q of quesBefore) {\n          const qresp = await fetch(`http://localhost:1337/api/quests/${q}`, {\n            method: 'DELETE'\n          });\n          if (!resp.ok) {\n            console.error(`删除原问题失败: ${resp.status}`);\n          }\n        }\n        // 移除原survey\n        const delSurveyResp = await fetch(`http://localhost:1337/api/surveys/${surveyTokenBefore}`, {\n          method: 'DELETE'\n        });\n        if (!delSurveyResp.ok) {\n          console.error(`移除原survey失败: ${delSurveyResp.status}`);\n        }\n        // 移除绑定surveys中的原问卷id\n\n        surveys.forEach((survey, index) => {\n          if (survey.id === surveyTokenBefore) {\n            surveys.splice(index, 1);\n          }\n        });\n        // 将移除了原surveyId的surveys覆盖给client\n        await updateUser('surveys', surveys, true);\n      } catch (err) {\n        console.error(err);\n      }\n    }\n\n    // 4. 清除创建问卷产生的会话存储, 以免影响后续使用\n    sessionStorage.clear();\n    setDraftOrPublish(true);\n    // // 直接刷新页面, 绕开因清理sessionStorage可能造成的null错误\n    // window.location.reload();\n    navigate('../published');\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: edit.entire,\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: edit.summaries,\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          onChange: handleTitleChange,\n          type: \"text\",\n          value: surveyTitle,\n          placeholder: '请输入问卷标题'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 441,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          onChange: handleDescrChange,\n          type: \"text\",\n          value: surveyDescr,\n          placeholder: '请输入问卷描述'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 442,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 440,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: edit.headerButtonBox,\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: saveDraft,\n          style: {\n            backgroundColor: 'transparent'\n          },\n          children: '保存草稿'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 445,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: edit.rightBtns,\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: publishSurvey,\n            style: {\n              color: \"black\"\n            },\n            children: '发布问卷'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 449,\n            columnNumber: 7\n          }, this), !!sessionStorage.length && /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: cancelSurvey,\n            style: {\n              backgroundColor: '#ff760e'\n            },\n            children: '取消'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 452,\n            columnNumber: 35\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 448,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 444,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 439,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: edit.quesDisplayZone,\n      children: [/*#__PURE__*/_jsxDEV(\"header\", {\n        children: '问卷编辑'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 459,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(GetTitleContext.Provider, {\n        value: draftTitle,\n        children: /*#__PURE__*/_jsxDEV(ConfirmEditContext.Provider, {\n          value: confirmEdit,\n          children: /*#__PURE__*/_jsxDEV(CancelEditContext.Provider, {\n            value: cancelEdit,\n            children: /*#__PURE__*/_jsxDEV(InitialDataContext.Provider, {\n              value: initialData,\n              children: [/*#__PURE__*/_jsxDEV(ReEditQueContext.Provider, {\n                value: editQue,\n                children: /*#__PURE__*/_jsxDEV(IsEditingContext.Provider, {\n                  value: isEditing,\n                  children: /*#__PURE__*/_jsxDEV(EditingQueContext.Provider, {\n                    value: queToEdit,\n                    children: !draftOrPublish && /*#__PURE__*/_jsxDEV(QuesList, {\n                      ques: ques,\n                      editingType: edintType,\n                      editCompleted: editCompleted\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 468,\n                      columnNumber: 13\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 466,\n                    columnNumber: 11\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 465,\n                  columnNumber: 10\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 464,\n                columnNumber: 9\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                children: [!adding && /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: handleAddQue,\n                  children: '添加问题'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 473,\n                  columnNumber: 22\n                }, this), adding && /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: [/*#__PURE__*/_jsxDEV(AddQue, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 478,\n                    columnNumber: 12\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    onClick: handleCompleteQue,\n                    style: {\n                      backgroundColor: 'rgba(69,136,251,0.8)'\n                    },\n                    children: '确认'\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 479,\n                    columnNumber: 12\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    onClick: handleCancel,\n                    children: '取消'\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 482,\n                    columnNumber: 12\n                  }, this)]\n                }, void 0, true)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 472,\n                columnNumber: 9\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 463,\n              columnNumber: 8\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 462,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 461,\n          columnNumber: 6\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 460,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 458,\n      columnNumber: 4\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 438,\n    columnNumber: 3\n  }, this);\n};\n_s(Edit, \"mOeKmiwgzncTW06Fmj84fIctZZ8=\", false, function () {\n  return [useNavigate, useSaveSurveyMutation, useCreateQueMutation, useUpdateSurveyMutation];\n});\n_c = Edit;\nexport default Edit;\nvar _c;\n$RefreshReg$(_c, \"Edit\");","map":{"version":3,"names":["React","useCallback","useEffect","useRef","useState","QuesList","AddQue","GetTitleContext","useCreateQueMutation","useSaveSurveyMutation","useUpdateSurveyMutation","filterQueDetails","CancelEditContext","ConfirmEditContext","EditingQueContext","InitialDataContext","IsEditingContext","ReEditQueContext","updateUser","useNavigate","edit","jsxDEV","_jsxDEV","Fragment","_Fragment","Edit","_s","sessionStorage","clear","navigate","adding","setAdding","addingTitle","setAddingTitle","addComplete","setAddComplete","ques","setQues","draftOrPublish","setDraftOrPublish","storageSurveyTitle","getItem","storageSurveyDescription","isFromDrafts","surveyTitle","setSurveyTitle","surveyDescr","setSurveyDescr","nums","length","questionDatas","i","key","data","JSON","parse","push","sort","a","b","index","questions","forEach","title","type","handleTitleChange","e","newTitle","target","value","setItem","handleDescrChange","newDescr","handleAddQue","preventDefault","id","Date","now","draftTitle","console","log","saveTitle","queType","alert","handleCompleteQue","raw","options","Array","isArray","hasEmpty","some","opt","content","trim","handleCancel","removeItem","queToEdit","setQueToEdit","isEditing","setIsEditing","edintType","setEdingType","editCompleted","setEditCompleted","initialData","setInitialData","lastEditTitle","editQue","delteOrEdit","prevQues","filter","que","current","confirmEdit","newQues","cancelEdit","doSaveDraft","doSaveDraftQue","doUpdateDraft","saveDraft","attributes","description","clientId","localStorage","published","resp","unwrap","documentId","err","surveyToken","queTokens","entries","detail","stringify","fetch","result","json","surveys","surveyTokenBefore","surveyResp","surveyResult","quesBefore","q","qresp","method","ok","error","status","delSurveyResp","survey","splice","cancelSurvey","publishSurvey","endCollection","className","entire","children","summaries","onChange","placeholder","fileName","_jsxFileName","lineNumber","columnNumber","headerButtonBox","onClick","style","backgroundColor","rightBtns","color","quesDisplayZone","Provider","editingType","_c","$RefreshReg$"],"sources":["E:/Desktop/桌面/工作/编程/前端/projext/project/src/pages/main_nav_pages/nav_pages/edit.jsx"],"sourcesContent":["import React, {useCallback, useEffect, useRef, useState} from 'react';\r\nimport QuesList from \"../../../components/editSurvey/quesList\";\r\nimport AddQue from \"../../../components/editSurvey/addQue\";\r\nimport {GetTitleContext} from \"../../../components/editSurvey/context/getTitleContext\";\r\nimport {useCreateQueMutation, useSaveSurveyMutation, useUpdateSurveyMutation} from \"../../../services/apis\";\r\nimport {filterQueDetails} from \"../../../components/editSurvey/filterQueDetails\";\r\nimport {\r\n\tCancelEditContext,\r\n\tConfirmEditContext,\r\n\tEditingQueContext, InitialDataContext,\r\n\tIsEditingContext,\r\n\tReEditQueContext\r\n} from \"../../../components/editSurvey/context/reEditQueContext\";\r\nimport {updateUser} from \"../../../utils/updateUser\";\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport edit from '../../../style/edit/edit.module.css'\r\n\r\n\r\nconst Edit = () => {\r\n\tsessionStorage.clear();\r\n\tconst navigate = useNavigate();\r\n\t// 监测是否正在添加某个问题\r\n\tconst [adding, setAdding] = useState(false);\r\n\t// 正在添加的问题信息\r\n\tconst [addingTitle, setAddingTitle] = useState({});\r\n\t// 是否添加完毕\r\n\tconst [addComplete, setAddComplete] = useState(false);\r\n\t//  问题列表\r\n\tconst [ques, setQues] = useState([]);\r\n\t// 检测是否保存或发布\r\n\tconst [draftOrPublish, setDraftOrPublish] = useState(false);\r\n\r\n\t// 从草稿页面点击编辑跳转到publish时\r\n\t// 检测sessionStorage中是否存在需要编辑的键值对, 若为null则不是从草稿页面跳转过来的\r\n\tconst storageSurveyTitle = sessionStorage.getItem('surveyTitleBefore');\r\n\tconst storageSurveyDescription = sessionStorage.getItem('surveyDescriptionBefore');\r\n\tconst isFromDrafts = (storageSurveyTitle !== null || storageSurveyDescription !== null);\r\n\r\n\t// 问卷标题\r\n\tconst [surveyTitle, setSurveyTitle] = useState(isFromDrafts ? storageSurveyTitle : '');\r\n\t// 问卷描述\r\n\tconst [surveyDescr, setSurveyDescr] = useState(isFromDrafts ? storageSurveyDescription : '');\r\n\tuseEffect(() => {\r\n\t\tif (isFromDrafts) { // 如果跳转自drafts的编辑link\r\n\t\t\tconst nums = sessionStorage.length; // 相应draft从服务器拉取到本地的数据数目\r\n\t\t\tconst questionDatas = [];\r\n\t\t\tfor (let i = 0; i < nums; i++) {\r\n\t\t\t\t// 读取每个数据的key, 若为题目key则存储在列表中, 用于之后上传给ques\r\n\t\t\t\tconst key = sessionStorage.key(i);\r\n\t\t\t\tif (key === 'surveyTitleBefore' || key === 'surveyDescriptionBefore' || key === 'surveyTokenBefore' || key === 'queTokensBefore') {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tconst data = JSON.parse(sessionStorage.getItem(key));\r\n\t\t\t\tquestionDatas.push(data);\r\n\t\t\t}\r\n\t\t\t// 将data按index升序排序\r\n\t\t\tquestionDatas.sort((a, b) => a.index - b.index);\r\n\t\t\t// 将所需数据传递给ques\r\n\t\t\tconst questions = [];\r\n\t\t\tquestionDatas.forEach(data => {\r\n\t\t\t\tquestions.push({title: data.title, type: data.type});\r\n\t\t\t});\r\n\t\t\tsetQues(questions);\r\n\t\t}\r\n\t}, [isFromDrafts]);\r\n\r\n\t// 问卷标题\r\n\tconst handleTitleChange = useCallback(e => {\r\n\t\tconst newTitle = e.target.value;\r\n\t\tsetSurveyTitle(newTitle);\r\n\t\t// 将标题存储到 sessionStorage\r\n\t\tsessionStorage.setItem('surveyTitle', newTitle);\r\n\t}, []);\r\n\t// 问卷描述\r\n\tconst handleDescrChange = useCallback(e => {\r\n\t\tconst newDescr = e.target.value;\r\n\t\tsetSurveyDescr(newDescr);\r\n\t\t// 将描述存储到 sessionStorage\r\n\t\tsessionStorage.setItem('surveyDescription', newDescr);\r\n\t}, [])\r\n\r\n\t// 添加问题\r\n\tconst handleAddQue = useCallback((e) => {\r\n\t\te.preventDefault();\r\n\t\tsetAdding(true);\r\n\t\tsetAddComplete(false);\r\n\t\tsetDraftOrPublish(false);\r\n\t\t// 清除上一次草稿中保存的题目title, 避免因取消空标题的添加造成的清除前一个sessionStorage\r\n\t\tsetAddingTitle({title: '', id: Date.now()});\r\n\t}, [adding, addComplete]);\r\n\t// 获得问题 title 用于定位 sessionStorage 中的存储\r\n\t// 草稿---未确认添加\r\n\tfunction draftTitle(title) {\r\n\t\tconsole.log(title);\r\n\t\t// 将获得的标题传给 addingTitle, 即正在使用的标题\r\n\t\tsetAddingTitle({title, id: Date.now()});\r\n\t}\r\n\r\n\t// 确认添加---保存问题->ques\r\n\tfunction saveTitle() {\r\n\t\tif (addingTitle.title.length !== 0) {\r\n\t\t\tconst queType = JSON.parse(sessionStorage.getItem(addingTitle.title)).type;\r\n\t\t\tsetQues([...ques, {...addingTitle, type: queType}]);\r\n\t\t} else {\r\n\t\t\talert('问题内容不可为空')\r\n\t\t}\r\n\t}\r\n\r\n\t// 确认添加\r\n\tconst handleCompleteQue = e => {\r\n\t\te.preventDefault();\r\n\t\t// 检查题目信息\r\n\t\tconst raw = sessionStorage.getItem(addingTitle.title);\r\n\t\tif (!raw) {\r\n\t\t\talert('请先完善题目内容');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst data = JSON.parse(raw);\r\n\t\tconst type = data?.type;\r\n\t\t// 检查是否存在空选项（含仅空白）或没有选项\r\n\t\tif (type === 'single' || type === 'checkbox') {\r\n\t\t\tconst options = Array.isArray(data.options) ? data.options : [];\r\n\t\t\tconst hasEmpty = options.some(opt => {\r\n\t\t\t\tif (!opt) return true;\r\n\t\t\t\tconst content = typeof opt.content === 'string' ? opt.content.trim() : '';\r\n\t\t\t\treturn content.length === 0;\r\n\t\t\t});\r\n\t\t\tif (options.length === 0 || hasEmpty) {\r\n\t\t\t\talert('选项内容不可为空');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tsaveTitle();\r\n\t\t\tsetAdding(false);\r\n\t\t\tsetAddComplete(true);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsaveTitle();\r\n\t\tsetAdding(false);\r\n\t\tsetAddComplete(true);\r\n\t};\r\n\r\n\r\n\t// 取消添加\r\n\tconst handleCancel = useCallback(e => {\r\n\t\te.preventDefault();\r\n\t\tsetAdding(false);\r\n\t\tsetAddComplete(false);\r\n\t\tsetDraftOrPublish(false);\r\n\t\t// 取消添加时移除sessionStorage中存储的临时信息\r\n\t\tsessionStorage.removeItem(addingTitle.title);\r\n\t\t// 清空当前问题草稿\r\n\t\tsetAddingTitle({});\r\n\t}, [adding, addComplete, addingTitle])\r\n\r\n\r\n\t// 编辑问题\r\n\tconst [queToEdit, setQueToEdit] = useState('');\r\n\tconst [isEditing, setIsEditing] = useState(false);\r\n\tconst [edintType, setEdingType] = useState(null);\r\n\tconst [editCompleted, setEditCompleted] = useState(false);\r\n\tconst [initialData, setInitialData] = useState(null);\r\n\tconst lastEditTitle = useRef('');\r\n\r\n\t/*\r\n\t* 编辑问题\r\n\t* @title 需要编辑的问题title\r\n\t* @deleteOrEdit Bool, true:delete, false:edit*/\r\n\tfunction editQue(title, delteOrEdit) {\r\n\t\t// 删除问题\r\n\t\tif (delteOrEdit) {\r\n\t\t\tsetQues(prevQues => prevQues.filter(que => que.title !== title));\r\n\t\t\tsessionStorage.removeItem(title);\r\n\t\t\tsetIsEditing(false);\r\n\t\t\tsetQueToEdit('');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// 编辑问题\r\n\t\t// 需要编辑的问题\r\n\t\tconst data = JSON.parse(sessionStorage.getItem(title));\r\n\t\tconsole.log('点击编辑前的数据------', data);\r\n\t\tconst type = data.type;\r\n\t\tsetQueToEdit(title);\r\n\t\tsetIsEditing(true);\r\n\t\tsetEdingType(type)\r\n\t\t// 将点击编辑前的数据保留下来\r\n\t\tsetInitialData(data);\r\n\t\tlastEditTitle.current = title;\r\n\t}\r\n\r\n\t/*\r\n\t* 确认编辑\r\n\t* */\r\n\tfunction confirmEdit(title) {\r\n\t\tsetQueToEdit(title);\r\n\t\tsetIsEditing(false);\r\n\t\tsetEditCompleted(true);\r\n\t\t// 更新 ques\r\n\t\tconst newQues = ques;\r\n\t\tnewQues.forEach(que => {\r\n\t\t\tif (que.title === lastEditTitle.current) {\r\n\t\t\t\tque.title = title;\r\n\t\t\t\tque.type = edintType;\r\n\t\t\t}\r\n\t\t})\r\n\t\tsetQues(newQues);\r\n\t}\r\n\r\n\t/*\r\n\t* 取消编辑\r\n\t* */\r\n\tfunction cancelEdit() {\r\n\t\tsetQueToEdit('');\r\n\t\tsetIsEditing(false);\r\n\t\tsetEditCompleted(true);\r\n\t\t// 重传 ques\r\n\t\tsetQues(ques);\r\n\t}\r\n\r\n\t// 将survey保存到草稿\r\n\tconst [doSaveDraft, {}] = useSaveSurveyMutation();\r\n\tconst [doSaveDraftQue, {}] = useCreateQueMutation();\r\n\tconst [doUpdateDraft, {}] = useUpdateSurveyMutation();\r\n\r\n\tasync function saveDraft(e) {\r\n\t\te.preventDefault();\r\n\t\t// 1. 先上传survey的基础信息\r\n\t\tconst data = {\r\n\t\t\tattributes: {\r\n\t\t\t\ttitle: surveyTitle,\r\n\t\t\t\tdescription: surveyDescr,\r\n\t\t\t\tclientId: localStorage.getItem('token'),\r\n\t\t\t\tpublished: false\r\n\t\t\t}\r\n\t\t};\r\n\t\tif (!ques[0] || !surveyTitle || !surveyDescr) {\r\n\t\t\talert('问题不可为空!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tconst resp = await doSaveDraft(data).unwrap();\r\n\t\t\tconsole.log('保存问卷成功', resp);\r\n\t\t\t// 将surveyToken临时储存在本地, 用于问题上传的绑定\r\n\t\t\tsessionStorage.setItem('tempSurveyToken', resp.data.documentId);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.log('保存draft失败', err);\r\n\t\t}\r\n\t\tconst surveyToken = sessionStorage.getItem('tempSurveyToken');\r\n\t\t// 将该survey绑定给创建问卷的用户\r\n\t\tawait updateUser('surveys', {id: surveyToken, published: false}, false);\r\n\t\t// 2. 上传问题信息并绑定survey\r\n\t\tsessionStorage.removeItem(''); // 移除会话存储中的空白token\r\n\t\tconst queTokens = [];\r\n\t\tfor (const [index, que] of ques.entries()) {\r\n\t\t\tconst detail = filterQueDetails(que, index, surveyToken);\r\n\t\t\tif (!detail) continue;\r\n\t\t\ttry {\r\n\t\t\t\tconst resp = await doSaveDraftQue(detail).unwrap();\r\n\t\t\t\tconsole.log('保存问题成功', resp);\r\n\t\t\t\t// 将queToken保存在数组中, 用于后续更新survey中的questions\r\n\t\t\t\tqueTokens.push(resp.data.documentId);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.log('保存问题失败', err);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// 3. 更新survey中的questions\r\n\t\tdata.attributes.questions = JSON.stringify(queTokens);\r\n\t\ttry {\r\n\t\t\tconst resp = await doUpdateDraft(data).unwrap();\r\n\t\t\tconsole.log('绑定问题成功', resp);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.log('绑定问题失败', err);\r\n\t\t}\r\n\t\t// 3.5 移除原来的draft相关内容\r\n\t\tif (isFromDrafts) {\r\n\t\t\ttry {\r\n\t\t\t\tconst resp = await fetch(`http://localhost:1337/api/clients/${localStorage.getItem('token')}`);\r\n\t\t\t\tconst result = await resp.json();\r\n\t\t\t\tconsole.log(result);\r\n\t\t\t\tconst surveys = result.data.surveys;\r\n\t\t\t\tconst surveyTokenBefore = sessionStorage.getItem('surveyTokenBefore');\r\n\t\t\t\t// 移除原survey绑定的question\r\n\t\t\t\tconst surveyResp = await fetch(`http://localhost:1337/api/surveys/${surveyTokenBefore}`);\r\n\t\t\t\tconst surveyResult = await surveyResp.json();\r\n\t\t\t\tconst quesBefore = surveyResult.data.questions;\r\n\t\t\t\tfor (const q of quesBefore) {\r\n\t\t\t\t\tconst qresp = await fetch(`http://localhost:1337/api/quests/${q}`, {\r\n\t\t\t\t\t\tmethod: 'DELETE',\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!resp.ok) {\r\n\t\t\t\t\t\tconsole.error(`删除原问题失败: ${resp.status}`);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 移除原survey\r\n\t\t\t\tconst delSurveyResp = await fetch(`http://localhost:1337/api/surveys/${surveyTokenBefore}`, {\r\n\t\t\t\t\tmethod: 'DELETE',\r\n\t\t\t\t});\r\n\t\t\t\tif (!delSurveyResp.ok) {\r\n\t\t\t\t\tconsole.error(`移除原survey失败: ${delSurveyResp.status}`);\r\n\t\t\t\t}\r\n\t\t\t\t// 移除绑定surveys中的原问卷id\r\n\r\n\t\t\t\tsurveys.forEach((survey, index) => {\r\n\t\t\t\t\tif (survey.id === surveyTokenBefore) {\r\n\t\t\t\t\t\tsurveys.splice(index, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t// 将移除了原surveyId的surveys覆盖给client\r\n\t\t\t\tawait updateUser('surveys', surveys, true);\r\n\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\t// 4. 清除创建问卷产生的会话存储, 以免影响后续使用\r\n\t\tsessionStorage.clear();\r\n\t\tsetDraftOrPublish(true);\r\n\t\t// // 直接刷新页面, 绕开因清理sessionStorage可能造成的null错误\r\n\t\t// window.location.reload();\r\n\t\tnavigate('../draft');\r\n\t}\r\n\r\n\t// 取消问卷\r\n\tfunction cancelSurvey(e) {\r\n\t\te.preventDefault();\r\n\t\t// 清除创建问卷产生的会话存储, 以免影响后续使用\r\n\t\tsessionStorage.clear();\r\n\t\t// 清理缓存\r\n\t\tsetQues([]);\r\n\t\tsetSurveyTitle('');\r\n\t\tsetSurveyDescr('');\r\n\t\tif (isFromDrafts) navigate('../draft');\r\n\t}\r\n\r\n\tasync function publishSurvey(e) {\r\n\t\te.preventDefault();\r\n\t\t// 1. 先上传survey的基础信息\r\n\t\tconst data = {\r\n\t\t\tattributes: {\r\n\t\t\t\ttitle: surveyTitle,\r\n\t\t\t\tdescription: surveyDescr,\r\n\t\t\t\tclientId: localStorage.getItem('token'),\r\n\t\t\t\tpublished: true,\r\n\t\t\t\tendCollection: false\r\n\t\t\t}\r\n\t\t};\r\n\t\tif (!ques[0] || !surveyTitle || !surveyDescr) {\r\n\t\t\talert('问题不可为空!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tconst resp = await doSaveDraft(data).unwrap();\r\n\t\t\tconsole.log('保存问卷成功', resp);\r\n\t\t\t// 将surveyToken临时储存在本地, 用于问题上传的绑定\r\n\t\t\tsessionStorage.setItem('tempSurveyToken', resp.data.documentId);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.log('保存draft失败', err);\r\n\t\t}\r\n\t\tconst surveyToken = sessionStorage.getItem('tempSurveyToken');\r\n\t\t// 将该survey绑定给创建问卷的用户\r\n\t\tawait updateUser('surveys', {id: surveyToken, published: true}, false);\r\n\t\t// 2. 上传问题信息并绑定survey\r\n\t\tsessionStorage.removeItem(''); // 移除会话存储中的空白token\r\n\t\tconst queTokens = [];\r\n\t\tfor (const [index, que] of ques.entries()) {\r\n\t\t\tconst detail = filterQueDetails(que, index, surveyToken);\r\n\t\t\tif (!detail) continue;\r\n\t\t\ttry {\r\n\t\t\t\tconst resp = await doSaveDraftQue(detail).unwrap();\r\n\t\t\t\tconsole.log('保存问题成功', resp);\r\n\t\t\t\t// 将queToken保存在数组中, 用于后续更新survey中的questions\r\n\t\t\t\tqueTokens.push(resp.data.documentId);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.log('保存问题失败', err);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// 3. 更新survey中的questions\r\n\t\tdata.attributes.questions = JSON.stringify(queTokens);\r\n\t\ttry {\r\n\t\t\tconst resp = await doUpdateDraft(data).unwrap();\r\n\t\t\tconsole.log('绑定问题成功', resp);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.log('绑定问题失败', err);\r\n\t\t}\r\n\t\t// 3.5 移除原来的draft相关内容\r\n\t\tif (isFromDrafts) {\r\n\t\t\ttry {\r\n\t\t\t\tconst resp = await fetch(`http://localhost:1337/api/clients/${localStorage.getItem('token')}`);\r\n\t\t\t\tconst result = await resp.json();\r\n\t\t\t\tconsole.log(result);\r\n\t\t\t\tconst surveys = result.data.surveys;\r\n\t\t\t\tconst surveyTokenBefore = sessionStorage.getItem('surveyTokenBefore');\r\n\t\t\t\t// 移除原survey绑定的question\r\n\t\t\t\tconst surveyResp = await fetch(`http://localhost:1337/api/surveys/${surveyTokenBefore}`);\r\n\t\t\t\tconst surveyResult = await surveyResp.json();\r\n\t\t\t\tconst quesBefore = surveyResult.data.questions;\r\n\t\t\t\tfor (const q of quesBefore) {\r\n\t\t\t\t\tconst qresp = await fetch(`http://localhost:1337/api/quests/${q}`, {\r\n\t\t\t\t\t\tmethod: 'DELETE',\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!resp.ok) {\r\n\t\t\t\t\t\tconsole.error(`删除原问题失败: ${resp.status}`);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 移除原survey\r\n\t\t\t\tconst delSurveyResp = await fetch(`http://localhost:1337/api/surveys/${surveyTokenBefore}`, {\r\n\t\t\t\t\tmethod: 'DELETE',\r\n\t\t\t\t});\r\n\t\t\t\tif (!delSurveyResp.ok) {\r\n\t\t\t\t\tconsole.error(`移除原survey失败: ${delSurveyResp.status}`);\r\n\t\t\t\t}\r\n\t\t\t\t// 移除绑定surveys中的原问卷id\r\n\r\n\t\t\t\tsurveys.forEach((survey, index) => {\r\n\t\t\t\t\tif (survey.id === surveyTokenBefore) {\r\n\t\t\t\t\t\tsurveys.splice(index, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t// 将移除了原surveyId的surveys覆盖给client\r\n\t\t\t\tawait updateUser('surveys', surveys, true);\r\n\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\t// 4. 清除创建问卷产生的会话存储, 以免影响后续使用\r\n\t\tsessionStorage.clear();\r\n\t\tsetDraftOrPublish(true);\r\n\t\t// // 直接刷新页面, 绕开因清理sessionStorage可能造成的null错误\r\n\t\t// window.location.reload();\r\n\t\tnavigate('../published');\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className={edit.entire}>\r\n\t\t\t<header>\r\n\t\t\t\t<div className={edit.summaries}>\r\n\t\t\t\t\t<input onChange={handleTitleChange} type=\"text\" value={surveyTitle} placeholder={'请输入问卷标题'}/>\r\n\t\t\t\t\t<input onChange={handleDescrChange} type=\"text\" value={surveyDescr} placeholder={'请输入问卷描述'}/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className={edit.headerButtonBox}>\r\n\t\t\t\t\t<button onClick={saveDraft} style={{\r\n\t\t\t\t\t\tbackgroundColor: 'transparent'\r\n\t\t\t\t\t}}>{'保存草稿'}</button>\r\n\t\t\t\t\t<div className={edit.rightBtns}>\r\n\t\t\t\t\t\t<button onClick={publishSurvey} style={{\r\n\t\t\t\t\t\t\tcolor: \"black\"\r\n\t\t\t\t\t\t}}>{'发布问卷'}</button>\r\n\t\t\t\t\t\t{!!sessionStorage.length && <button onClick={cancelSurvey} style={{\r\n\t\t\t\t\t\t\tbackgroundColor: '#ff760e'\r\n\t\t\t\t\t\t}}>{'取消'}</button>}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</header>\r\n\t\t\t<div className={edit.quesDisplayZone}>\r\n\t\t\t\t<header>{'问卷编辑'}</header>\r\n\t\t\t\t<GetTitleContext.Provider value={draftTitle}>\r\n\t\t\t\t\t<ConfirmEditContext.Provider value={confirmEdit}>\r\n\t\t\t\t\t\t<CancelEditContext.Provider value={cancelEdit}>\r\n\t\t\t\t\t\t\t<InitialDataContext.Provider value={initialData}>\r\n\t\t\t\t\t\t\t\t<ReEditQueContext.Provider value={editQue}>\r\n\t\t\t\t\t\t\t\t\t<IsEditingContext.Provider value={isEditing}>\r\n\t\t\t\t\t\t\t\t\t\t<EditingQueContext.Provider value={queToEdit}>\r\n\t\t\t\t\t\t\t\t\t\t\t{!draftOrPublish &&\r\n\t\t\t\t\t\t\t\t\t\t\t\t<QuesList ques={ques} editingType={edintType} editCompleted={editCompleted}/>}\r\n\t\t\t\t\t\t\t\t\t\t</EditingQueContext.Provider>\r\n\t\t\t\t\t\t\t\t\t</IsEditingContext.Provider>\r\n\t\t\t\t\t\t\t\t</ReEditQueContext.Provider>\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t{!adding && <button onClick={handleAddQue}>{'添加问题'}</button>}\r\n\t\t\t\t\t\t\t\t\t{adding && (\r\n\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t{/* 使用context传递获取标题的函数 */}\r\n\t\t\t\t\t\t\t\t\t\t\t{/* 存储到草稿中, 确认添加时通过handleCompleteQue将问题存储到ques, 取消时通过handleCancel移除草稿 */}\r\n\t\t\t\t\t\t\t\t\t\t\t<AddQue/>\r\n\t\t\t\t\t\t\t\t\t\t\t<button onClick={handleCompleteQue} style={{\r\n\t\t\t\t\t\t\t\t\t\t\t\tbackgroundColor: 'rgba(69,136,251,0.8)'\r\n\t\t\t\t\t\t\t\t\t\t\t}}>{'确认'}</button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button onClick={handleCancel}>{'取消'}</button>\r\n\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</InitialDataContext.Provider>\r\n\t\t\t\t\t\t</CancelEditContext.Provider>\r\n\t\t\t\t\t</ConfirmEditContext.Provider>\r\n\t\t\t\t</GetTitleContext.Provider>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default Edit;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}