{"ast":null,"code":"/*\r\n* 更新用户数据(push)\r\n* @updateElement: 需要更新的数据:string, 'username','pwd','surveys','answers'\r\n* @newElement: string, 对于 username/pwd: 更新后的数据, 对于 surveys/answers: 需要添加的数据id\r\n* */\nexport async function updateUser(updateElement, newElement) {\n  const clientDocumentId = localStorage.getItem('token');\n  const url = `http://localhost:1337/api/clients/${clientDocumentId}`;\n  // 先获取用户数据\n  const data = await async function () {\n    try {\n      const resp = await fetch(url);\n      if (!resp.ok) {\n        throw new Error(`获取数据失败: ${resp.status}`);\n      }\n      return await resp.json();\n    } catch (err) {\n      console.error(err);\n      return null;\n    }\n  }();\n  // 更新用户数据\n  switch (updateElement) {\n    case 'username':\n    case 'pwd':\n      {\n        try {\n          const resp = await fetch(url, {\n            method: 'PUT',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            // 仅更新需要更新的数据\n            body: JSON.stringify({\n              data: {\n                [updateElement]: newElement\n              }\n            })\n          });\n          if (!resp.ok) {\n            throw new Error(`更新 ${updateElement} 失败: ${resp.status}`);\n          }\n          const updated = await resp.json();\n          console.log('更新用户数据成功', updated);\n        } catch (err) {\n          console.error(err);\n        }\n        break;\n      }\n    case 'surveys':\n    case 'answers':\n      {\n        var _data$data;\n        const last = data === null || data === void 0 ? void 0 : (_data$data = data.data) === null || _data$data === void 0 ? void 0 : _data$data[updateElement];\n        const lastNull = last == null;\n        try {\n          const resp = await fetch(url, {\n            method: 'PUT',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            // 根据原本是否有数据进行更新\n            body: JSON.stringify({\n              data: {\n                [updateElement]: !lastNull ? [...last, newElement] : [newElement]\n              }\n            })\n          });\n          if (!resp.ok) {\n            throw new Error(`更新 ${updateElement} 失败: ${resp.status}`);\n          }\n          const updated = await resp.json();\n          console.log('更新用户数据成功', updated);\n        } catch (err) {\n          console.error(err);\n        }\n        break;\n      }\n  }\n}","map":{"version":3,"names":["updateUser","updateElement","newElement","clientDocumentId","localStorage","getItem","url","data","resp","fetch","ok","Error","status","json","err","console","error","method","headers","body","JSON","stringify","updated","log","_data$data","last","lastNull"],"sources":["E:/Desktop/桌面/工作/编程/前端/projext/project/src/utils/updateUser.js"],"sourcesContent":["/*\r\n* 更新用户数据(push)\r\n* @updateElement: 需要更新的数据:string, 'username','pwd','surveys','answers'\r\n* @newElement: string, 对于 username/pwd: 更新后的数据, 对于 surveys/answers: 需要添加的数据id\r\n* */\r\nexport async function updateUser(updateElement, newElement) {\r\n\tconst clientDocumentId = localStorage.getItem('token');\r\n\tconst url = `http://localhost:1337/api/clients/${clientDocumentId}`;\r\n\t// 先获取用户数据\r\n\tconst data = await (async function () {\r\n\t\ttry {\r\n\t\t\tconst resp = await fetch(url);\r\n\t\t\tif (!resp.ok) {\r\n\t\t\t\tthrow new Error(`获取数据失败: ${resp.status}`);\r\n\t\t\t}\r\n\t\t\treturn await resp.json();\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t})();\r\n\t// 更新用户数据\r\n\tswitch (updateElement) {\r\n\t\tcase 'username':\r\n\t\tcase 'pwd': {\r\n\t\t\ttry {\r\n\t\t\t\tconst resp = await fetch(url, {\r\n\t\t\t\t\tmethod: 'PUT',\r\n\t\t\t\t\theaders: {'Content-Type': 'application/json'},\r\n\t\t\t\t\t// 仅更新需要更新的数据\r\n\t\t\t\t\tbody: JSON.stringify({data: {[updateElement]: newElement}})\r\n\t\t\t\t});\r\n\t\t\t\tif (!resp.ok) {\r\n\t\t\t\t\tthrow new Error(`更新 ${updateElement} 失败: ${resp.status}`);\r\n\t\t\t\t}\r\n\t\t\t\tconst updated = await resp.json();\r\n\t\t\t\tconsole.log('更新用户数据成功', updated);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'surveys':\r\n\t\tcase 'answers': {\r\n\t\t\tconst last = data?.data?.[updateElement];\r\n\t\t\tconst lastNull = last == null;\r\n\t\t\ttry {\r\n\t\t\t\tconst resp = await fetch(url, {\r\n\t\t\t\t\tmethod: 'PUT',\r\n\t\t\t\t\theaders: {'Content-Type': 'application/json'},\r\n\t\t\t\t\t// 根据原本是否有数据进行更新\r\n\t\t\t\t\tbody: JSON.stringify({data: {[updateElement]: !lastNull?[...last, newElement]:[newElement]}})\r\n\t\t\t\t});\r\n\t\t\t\tif (!resp.ok) {\r\n\t\t\t\t\tthrow new Error(`更新 ${updateElement} 失败: ${resp.status}`);\r\n\t\t\t\t}\r\n\t\t\t\tconst updated = await resp.json();\r\n\t\t\t\tconsole.log('更新用户数据成功', updated);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n}"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA,OAAO,eAAeA,UAAUA,CAACC,aAAa,EAAEC,UAAU,EAAE;EAC3D,MAAMC,gBAAgB,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EACtD,MAAMC,GAAG,GAAG,qCAAqCH,gBAAgB,EAAE;EACnE;EACA,MAAMI,IAAI,GAAG,MAAO,kBAAkB;IACrC,IAAI;MACH,MAAMC,IAAI,GAAG,MAAMC,KAAK,CAACH,GAAG,CAAC;MAC7B,IAAI,CAACE,IAAI,CAACE,EAAE,EAAE;QACb,MAAM,IAAIC,KAAK,CAAC,WAAWH,IAAI,CAACI,MAAM,EAAE,CAAC;MAC1C;MACA,OAAO,MAAMJ,IAAI,CAACK,IAAI,CAAC,CAAC;IACzB,CAAC,CAAC,OAAOC,GAAG,EAAE;MACbC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC;MAClB,OAAO,IAAI;IACZ;EACD,CAAC,CAAE,CAAC;EACJ;EACA,QAAQb,aAAa;IACpB,KAAK,UAAU;IACf,KAAK,KAAK;MAAE;QACX,IAAI;UACH,MAAMO,IAAI,GAAG,MAAMC,KAAK,CAACH,GAAG,EAAE;YAC7BW,MAAM,EAAE,KAAK;YACbC,OAAO,EAAE;cAAC,cAAc,EAAE;YAAkB,CAAC;YAC7C;YACAC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;cAACd,IAAI,EAAE;gBAAC,CAACN,aAAa,GAAGC;cAAU;YAAC,CAAC;UAC3D,CAAC,CAAC;UACF,IAAI,CAACM,IAAI,CAACE,EAAE,EAAE;YACb,MAAM,IAAIC,KAAK,CAAC,MAAMV,aAAa,QAAQO,IAAI,CAACI,MAAM,EAAE,CAAC;UAC1D;UACA,MAAMU,OAAO,GAAG,MAAMd,IAAI,CAACK,IAAI,CAAC,CAAC;UACjCE,OAAO,CAACQ,GAAG,CAAC,UAAU,EAAED,OAAO,CAAC;QACjC,CAAC,CAAC,OAAOR,GAAG,EAAE;UACbC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC;QACnB;QACA;MACD;IACA,KAAK,SAAS;IACd,KAAK,SAAS;MAAE;QAAA,IAAAU,UAAA;QACf,MAAMC,IAAI,GAAGlB,IAAI,aAAJA,IAAI,wBAAAiB,UAAA,GAAJjB,IAAI,CAAEA,IAAI,cAAAiB,UAAA,uBAAVA,UAAA,CAAavB,aAAa,CAAC;QACxC,MAAMyB,QAAQ,GAAGD,IAAI,IAAI,IAAI;QAC7B,IAAI;UACH,MAAMjB,IAAI,GAAG,MAAMC,KAAK,CAACH,GAAG,EAAE;YAC7BW,MAAM,EAAE,KAAK;YACbC,OAAO,EAAE;cAAC,cAAc,EAAE;YAAkB,CAAC;YAC7C;YACAC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;cAACd,IAAI,EAAE;gBAAC,CAACN,aAAa,GAAG,CAACyB,QAAQ,GAAC,CAAC,GAAGD,IAAI,EAAEvB,UAAU,CAAC,GAAC,CAACA,UAAU;cAAC;YAAC,CAAC;UAC7F,CAAC,CAAC;UACF,IAAI,CAACM,IAAI,CAACE,EAAE,EAAE;YACb,MAAM,IAAIC,KAAK,CAAC,MAAMV,aAAa,QAAQO,IAAI,CAACI,MAAM,EAAE,CAAC;UAC1D;UACA,MAAMU,OAAO,GAAG,MAAMd,IAAI,CAACK,IAAI,CAAC,CAAC;UACjCE,OAAO,CAACQ,GAAG,CAAC,UAAU,EAAED,OAAO,CAAC;QACjC,CAAC,CAAC,OAAOR,GAAG,EAAE;UACbC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC;QACnB;QACA;MACD;EACD;AACD","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}