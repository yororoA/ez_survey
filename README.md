# 在线问卷调查系统项目介绍

## 📋 项目概述

这是一个基于 **React** 前端和 **Strapi** 后端的现代化在线问卷调查系统。该系统提供了完整的问卷创建、编辑、发布、填写和数据分析功能，支持多种题型，具有用户友好的界面和强大的数据管理能力。

## 🛠️ 技术栈

### 前端技术

- **React 19.1.1** - 主要前端框架
- **React Router DOM 7.8.1** - 路由管理
- **Redux Toolkit 2.8.2** - 状态管理
- **React Redux 9.2.0** - React与Redux连接
- **CSS Modules** - 样式管理（使用.module.css）
- **Less** - CSS预处理器

### 后端技术

- **Strapi 5.23.0** - 无头CMS框架
- **Better SQLite3** - 数据库
- **bcrypt** - 密码加密
- **Node.js** - 服务器运行环境

### 开发工具

- **React Scripts 5.0.1** - 构建工具
- **Testing Library** - 测试框架

## 🏗️ 项目架构

### 前端架构

```
src/
├── components/           # 可复用组件
│   ├── check&fill/      # 问卷填写相关组件
│   ├── draftsDisplay/   # 草稿显示组件
│   ├── editSurvey/      # 问卷编辑组件
│   ├── involvedDisplay/ # 参与问卷显示组件
│   └── publishedDisplay/# 已发布问卷显示组件
├── pages/               # 页面组件
│   ├── login.jsx        # 登录页面
│   ├── main_nav_pages/  # 主导航页面
│   └── check_fill_survey/ # 问卷填写页面
├── services/            # API服务
│   ├── apis.js          # API接口定义
│   └── store.js         # Redux store配置
├── utils/               # 工具函数
├── style/               # 样式文件
├── ui/                  # UI组件
└── context/             # React Context
```

### 后端架构

```
server/
├── src/api/             # API定义
│   ├── client/          # 用户管理
│   ├── survey/          # 问卷管理
│   ├── quest/           # 问题管理
│   └── answer/          # 答案管理
├── config/              # 配置文件
└── database/            # 数据库相关
```

## 🗄️ 数据模型

### Client（用户）

```json
{
  "username": "string",      // 用户名
  "pwd": "password",         // 加密密码
  "surveys": "json",         // 创建的问卷列表
  "answers": "json",         // 收到的答案列表
  "involved": "json"         // 参与的问卷列表
}
```

### Survey（问卷）

```json
{
  "title": "string",         // 问卷标题
  "description": "string",   // 问卷描述
  "clientId": "string",      // 创建者ID
  "published": "boolean",    // 是否发布
  "questions": "json",       // 问题ID列表
  "answers": "json",         // 答案ID列表
  "endCollection": "boolean" // 是否结束收集
}
```

### Quest（问题）

```json
{
  "title": "string",         // 问题标题
  "required": "boolean",     // 是否必填(只是用来占位,表示本来打算实现这个功能,但因为太懒最后还是没做)
  "options": "json",         // 选项（用于选择题）
  "max": "integer",          // 最大值（用于评分题、进度条）
  "step": "integer",         // 步长
  "surveyId": "string",      // 所属问卷ID
  "type": "string",          // 问题类型
  "index": "integer"         // 问题序号
}
```

### Answer（答案）

```json
{
  "surveyId": "string",      // 问卷ID
  "clientId": "string",      // 填写者ID
  "answers": "component"     // 答案组件（可重复）
}
```

## 🎯 核心功能

### 1. 用户认证系统

- **注册功能**：用户可以创建新账户，密码使用bcrypt加密存储
- **登录功能**：支持用户名密码登录，带有本地token缓存
- **会话管理**：自动检查本地token有效性，无效时自动退出登录

### 2. 问卷编辑系统

- **多种题型支持**：
  - 填空题（text）
  - 单选题（single）
  - 多选题（checkbox）
  - 评分题（rating）
  - 进度条（slider）
  - 定位题（location）
  - 下拉框（select，暂不支持）
  - 排序题 (没做, 不过拖拽功能感觉并不是很困难: 使用原生js监听鼠标位置进行元素拖拽; 使用h5的drag&drop api设置draggalble属性同时通过 dragstart/drag/dragend事件监听实现元素交换(insertBefore插到某个元素前面 / 与目标位置的原有元素交换元素数组中的索引产生重渲染实现交换);)

- **实时编辑功能**：
  - 动态添加/删除问题
  - 实时预览问卷效果
  - 拖拽排序（通过index管理）
  - 问题内容验证

### 3. 草稿管理

- **自动保存**：编辑过程中自动保存到sessionStorage(如果能重来一次我宁愿一开始就读服务器把数据放在context里或者把编辑过程的数据保存在数组里面往外层传也不要用sessionStorage)
- **草稿列表**：显示所有未发布的问卷草稿
- **草稿操作**：编辑、预览、删除、发布
- **数据恢复**：从草稿恢复到编辑状态

### 4. 问卷发布与分享

- **一键发布**：将草稿发布为可填写的问卷
- **链接生成**：自动生成问卷填写链接(弹出弹窗, 点击确认按钮时通过clipboard API将链接复制到剪贴板)
- **状态管理**：控制问卷的收集状态（进行中/已结束）

### 5. 问卷填写系统

- **URL验证**：检查问卷ID有效性和填写权限
- **防重复填写**：检测用户是否已经填写过
- **多题型渲染**：根据题型动态渲染对应的填写界面
- **数据提交**：安全提交答案到后端

### 6. 数据分析与可视化

- **答案统计**：收集和整理所有答案数据
- **可视化展示**：为不同题型提供相应的数据可视化

## 🔧 技术特色

### 1. 模块化设计

- **组件化架构**：每个功能模块都采用React组件化设计
- **Context API**：使用React Context进行跨组件状态传递
- **自定义Hook**：封装常用逻辑为可复用的Hook

### 2. 状态管理

- **Redux Toolkit**：使用现代Redux工具包进行状态管理
- **RTK Query**：用于API调用和缓存管理(我说rtk不是很好用, 可能是我还没学会怎么用吧)
- **SessionStorage**：临时数据存储和页面间数据传递

### 3. 路由设计

- **嵌套路由**：采用React Router的嵌套路由结构
- **懒加载**：使用React.lazy进行组件懒加载优化性能
- **路由守卫**：通过Outlet组件实现登录状态检查

### 4. 样式管理

- **CSS Modules**：避免样式冲突，提供组件级样式隔离
- **CSS变量**：使用CSS自定义属性管理主题色彩
- **响应式设计**：适配不同屏幕尺寸

### 5. 数据安全

- **密码加密**：使用bcrypt对用户密码进行安全加密
- **权限控制**：区分问卷创建者和填写者权限
- **数据验证**：前后端双重数据验证

## 🚀 核心流程

### 用户注册/登录流程

1. 用户输入用户名和密码
2. 前端验证输入完整性
3. 密码通过bcrypt加密
4. 存储用户信息到数据库
5. 返回用户token并保存到localStorage

### 问卷创建流程

1. 用户填写问卷标题和描述
2. 逐个添加不同类型的问题
3. 实时保存到sessionStorage
4. 选择保存草稿或直接发布
5. 数据提交到后端并清理缓存

### 问卷填写流程

1. 用户访问问卷链接
2. 系统验证问卷状态和用户权限
3. 渲染对应的问题填写界面
4. 用户逐题填写并暂存答案
5. 提交完整答案到后端

### 数据分析流程

1. 获取问卷的所有答案数据
2. 按问题类型分类处理数据
3. 生成对应的可视化组件
4. 展示统计结果和图表

## 📱 用户界面

### 主要页面

- **登录页面**：简洁的用户认证界面
- **首页**：功能导航和快速操作
- **问卷编辑页**：强大的问卷设计工具
- **草稿管理页**：草稿列表和操作
- **已发布问卷页**：问卷管理和数据查看
- **问卷填写页**：用户友好的填写界面

### UI特色

- **现代化设计**：采用现代Web设计理念
- **交互反馈**：丰富的用户交互反馈
- **响应式布局**：适配移动端和桌面端
- **主题一致性**：统一的色彩和样式规范

## 🔮 扩展功能

### 当前支持的高级功能

- **问卷预览**：发布前预览问卷效果
- **链接分享**：一键复制问卷填写链接
- **答案导出**：（可扩展）数据导出功能
- **用户参与记录**：追踪用户参与的问卷

## 🛡️ 安全性考虑

- **密码安全**：使用bcrypt进行密码散列
- **会话管理**：基于token的会话验证(说是token,其实因为懒得搞加密直接用的strapi数据库里的documentID)
- **数据验证**：前后端双重数据验证
- **权限隔离**：创建者和填写者权限分离
- **防重复提交**：检测并防止重复填写问卷

## 📈 性能优化

- **代码分割**：使用React.lazy进行路由级别的代码分割
- **组件优化**：使用React.memo和useCallback优化重渲染
- **缓存机制**：利用RTK Query的缓存机制减少网络请求
- **状态管理**：合理的状态设计避免不必要的组件更新

## 🔧 部署说明

### 后端部署

```bash
cd server
npm install
npm run develop  # 开发环境
npm run start    # 生产环境
```

### 前端部署

```bash
cd project
npm install
npm run build
npm start
```

### 环境变量

- `HOST`: 服务器主机地址（默认：0.0.0.0）
- `PORT`: 服务器端口（默认：1337）
- `APP_KEYS`: 应用密钥数组

***

目前已有的三个用户名: `amiya`, `rosmontis`, `nymph`
密码应该都是 `123456`, (直接注册得了)
strapi账号密码分别为 `123456@qq.com` `123456Aa`
